/**
 * webViewer - webViewer Project Generated from OsimisAngular
 * @authors 
 * @version v0.0.1
 * @link 
 * @license 
 */
!function(){"use strict";var e="0.2.9";angular.module("webviewer",["ngResource","ngSanitize","mgcrea.ngStrap","ngRangeFilter","debounce"]).constant("$",window.$).constant("_",window._).constant("pako",window.pako).constant("JpegImage",window.JpegImage).constant("hamster",window.Hamster).constant("cornerstone",window.cornerstone).constant("cornerstoneTools",window.cornerstoneTools).provider("wvConfig",function(){var t={version:e,orthancApiURL:"",webviewerApiURL:"web-viewer",defaultCompression:"jpeg95"};this.setApiURL=function(e){"/"===e.substr(-1)&&(e=e.substr(0,e.length-1)),t.orthancApiURL=e,t.webviewerApiURL=e+"/web-viewer"},this.$get=function(){return t}}).config(["$httpProvider",function(e){e.defaults.cache=!0,console.error("warning: cache is activated in the whole application")}])}(),function(){"use strict";function e(){function e(e){e=_.flatten(e),this._annotations=e||[]}return e.prototype.toArray=function(){return this._annotations},e.prototype.filterByType=function(t){var n=this._annotations.filter(function(e){return e.type===t});return new e(n)},e.prototype.filterByImageId=function(t){var n=this._annotations.filter(function(e){return e.imageId===t});return new e(n)},e.prototype.getImageIds=function(){return this._annotations.reduce(function(e,t){var n=t.imageId;return-1===e.indexOf(n)&&e.push(n),e},[])},e.prototype.getTypes=function(){return this._annotations.reduce(function(e,t){var n=t.type;return-1===e.indexOf(n)&&e.push(n),e},[])},e.prototype.mapByImageIds=function(t){var n=this._annotations.reduce(function(e,t){var n=t.imageId;return e.hasOwnProperty(n)||(e[n]=[]),e[n].push(t),e},{}),i=_(n).mapValues(function(t){return new e(t)}).value();return _(i).map(t).value()},e.prototype.hasType=function(e){return this._annotations.reduce(function(t,n){return t||n.type===e},!1)},e}angular.module("webviewer").factory("WvAnnotationGroup",e)}(),function(){"use strict";function e(e){function t(e){e=_.cloneDeep(e),i[e.type]=i[e.type]||{},i[e.type][e.imageId]=e,(!e.data||"undefined"!=typeof e.data.length&&0===e.data.length)&&delete i[e.type][e.imageId],o.onAnnotationChanged.trigger(e)}function n(e,t){return t?i[t]&&i[t][e]:_(i).flatMap(function(e){return _.values(e)}).filter(function(t){return t.imageId===e}).cloneDeep()}var i={},o={set:t,getByImageId:n,onAnnotationChanged:new osimis.Listener};return o}e.$inject=["WvAnnotationValueObject"],angular.module("webviewer").factory("wvAnnotationManager",e)}(),function(){"use strict";function e(){function e(e,t,n){this.type=e,this.imageId=t,this.data=n}return e}angular.module("webviewer").factory("WvAnnotationValueObject",e)}(),function(){"use strict";function e(e,t,i){function o(e,t){var o=t;o.imageId=e,o.color?o.render=i.renderColorImage:o.render=i.renderGrayscaleImage;var r=n(o);return o.getPixelData=function(){return r},o}var r={process:o};return r}function t(e,t,n,i,o){for(var r=(o-n)/(i-t),a=n-r*t,s=0,l=e.length;l>s;s++)e[s]=r*e[s]+a}function n(e){switch(e.Orthanc.Compression){case"Deflate":return o(e);case"Jpeg":return r(e);default:throw new Error("unknown compression")}}function i(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0,o=e.length;o>i;i++)n[i]=e.charCodeAt(i);return n}function o(e){var t,n,i,o=pako.inflate(window.atob(e.Orthanc.PixelData)),r=null;if(e.color)for(t=new ArrayBuffer(o.length/3*4),r=new Uint8Array(t),n=0,i=0;i<o.length;i+=3)r[n++]=o[i],r[n++]=o[i+1],r[n++]=o[i+2],r[n++]=255;else for(t=new ArrayBuffer(2*o.length),r=e.Orthanc.IsSigned?new Int16Array(t):new Uint16Array(t),n=0,i=0;i<o.length;i+=2){var a=o[i],s=o[i+1];r[n]=a+256*s,n++}return r}function r(e){var n=new JpegImage,o=i(window.atob(e.Orthanc.PixelData));n.parse(o);var r,a,s,l=n.getData(e.width,e.height),c=null;if(e.color)for(r=new ArrayBuffer(l.length/3*4),c=new Uint8ClampedArray(r),a=0,s=0;s<l.length;s+=3)c[a++]=l[s],c[a++]=l[s+1],c[a++]=l[s+2],c[a++]=255;else{for(r=new ArrayBuffer(2*l.length),c=e.Orthanc.IsSigned?new Int16Array(r):new Uint16Array(r),a=0,s=0;s<l.length;s++)c[a]=l[s],a++;e.Orthanc.Stretched&&t(c,0,e.Orthanc.StretchLow,255,e.Orthanc.StretchHigh)}return c}e.$inject=["$http","wvConfig","cornerstone"],angular.module("webviewer").factory("wvCornerstoneImageAdapter",e)}(),function(){"use strict";function e(e,t,n,i,o,r,a,s){function l(t){var n=this;if(!g.hasOwnProperty(t)){var i=t.split("|");t=i[0];var o=i.splice(1),s=o.map(function(e){i=e.split("~");var t=i[0],n=i.splice(1);if(!p.hasOwnProperty(t))throw new Error("wv-image: unknown post processor");var o=new(Function.prototype.bind.apply(p[t],[null].concat(n)));return o});i=t.split(":");var l=i[0];i[1]||0;g[t]=e.get(r.orthancApiURL+"/instances/"+l+"/simplified-tags").then(function(e){var i=e.data;return new a(n,t,i,s)})}return g[t]}function c(t){if(!d.hasOwnProperty(t)){var n=r.defaultCompression,i=t.split(":"),o=i[0],a=i[1];d[t]=e.get(r.webviewerApiURL+"/instances/"+n+"-"+o+"_"+a).then(function(e){return s.process(t,e.data)})}return d[t]}function u(e,t){p[e]=t}function v(e,r,a){function s(){u.css("overflow",v),$("#FAKE-VIEWPORT-USED-IN-IMAGE-SERVICE").remove(),l.$destroy()}var l=o.$new();l.size={width:r+"px",height:a+"px"},l.imageId=e;var c=n(['<wv-viewport id="FAKE-VIEWPORT-USED-IN-IMAGE-SERVICE"','wv-image-id="imageId"','wv-size="size"','wv-enable-overlay="false"','wv-angle-measure-viewport-tool="true"','wv-length-measure-viewport-tool="true"','wv-elliptical-roi-viewport-tool="true"','wv-zoom-viewport-tool="true"','wv-pan-viewport-tool="true"','wv-pixel-probe-viewport-tool="true"','wv-rectangle-roi-viewport-tool="true"',">","</wv-viewport>"].join("\n"))(l),u=$("body"),v=u.css("overflow");return u.css("overflow","hidden"),c.css("position","absolute"),c.css("left","-50000px"),u.append(c),t(function(e,t){i(function(){var t=null,n=c.find("canvas").get(0);t=n.toDataURL(),s(),e(t)})})}var w={get:l,getPixelObject:c,createAnnotedImage:v,registerPostProcessor:u},p={},g={},d={};return w}e.$inject=["$http","$q","$compile","$timeout","$rootScope","wvConfig","WvImage","wvCornerstoneImageAdapter"],angular.module("webviewer").factory("wvImageManager",e)}(),function(){"use strict";function e(e,t){function n(t,n,i,o){var r=this;this.id=n,this.tags=i,this.postProcesses=o||[],this.onAnnotationChanged=new osimis.Listener,e.onAnnotationChanged(function(e){e.imageId===r.id&&r.onAnnotationChanged.trigger(e)});var a=null;this.getPixelObject=function(){if(null===a){a=t.getPixelObject(this.id);var e=t.getPixelObject.bind(t);this.postProcesses.forEach(function(t){a=a.then(function(n){return t.execute(n,e)})})}return a}}return n.prototype.getAnnotations=function(t){return e.getByImageId(this.id,t)},n.prototype.setAnnotations=function(n,i){var o=new t(n,this.id,i);e.set(o)},n}e.$inject=["wvAnnotationManager","WvAnnotationValueObject"],angular.module("webviewer").factory("WvImage",e)}(),function(){"use strict";function e(){function e(){}return e}angular.module("webviewer").factory("WvMask",e)}(),function(){"use strict";function e(e,t){function n(){this.masksImageIds=Array.prototype.slice.call(arguments)}function i(e){if(!e.color){var t=e.getPixelData();e.getPixelData=function(){for(var e=new ArrayBuffer(4*t.length),n=new Uint8ClampedArray(e),i=0,o=0;o<t.length;++o)n[i++]=t[o],n[i++]=t[o],n[i++]=t[o],n[i++]=255;return n},e.color=!0,e.render=cornerstone.renderColorImage}}function o(t,n){var i=e.cloneDeep(t),o=i.getPixelData(),r=n.getPixelData();return i.getPixelData=function(){for(var e=0;e<o.length;e+=4)r[e+0]>0&&(o[e+0]=o[e+0]/2+r[e+0]/2);return o},i}return n.prototype.execute=function(e,n){i(e);var r=this.masksImageIds.map(function(e){return n(e)});return t.all(r).then(function(t){return t.reduce(function(e,t){return i(t),o(e,t)},e)})},n}e.$inject=["_","$q"],angular.module("webviewer").factory("WvColorMaskPostProcessor",e).run(["wvImageManager","WvColorMaskPostProcessor",function(e,t){e.registerPostProcessor("colormask",t)}])}(),function(){"use strict";function e(){function e(e,t,n,i){var o=this;e.vm.showTopLeftArea=function(){return!!e.vm.wvTags},e.vm.showTopRightArea=function(){return!!e.vm.wvTags&&!!e.vm.wvTags.SeriesDescription&&!!e.vm.wvTags.SeriesNumber},e.vm.showBottomRightArea=function(){return!!e.vm.wvViewport},e.vm.wvShowTimeline="undefined"==typeof e.vm.wvShowTimeline?!0:e.vm.wvShowTimeline,e.vm.wvShowTimeline=e.vm.wvShowTimeline&&!!i.serie,e.vm.wvShowTimeline&&"undefined"==typeof e.vm.wvSerie&&(i.serie.onSerieChanged(this,function(t){e.vm.wvSerie=t}),e.$on("$destroy",function(){i.serie.onSerieChanged.close(o)}))}var n={bindToController:!0,controller:t,controllerAs:"vm",link:e,restrict:"E",transclude:!0,require:{serie:"?^^wvSerieId"},templateUrl:"app/overlay/overlay.directive.html",scope:{wvTags:"=?",wvSerie:"=?",wvViewport:"=?",wvShowTimeline:"=?"}};return n}function t(){}angular.module("webviewer").directive("wvOverlay",e)}(),function(){"use strict";function e(){function e(e,t,n){function i(){var t=Math.ceil(100*(e.vm.wvShownImageIndex+1)/e.vm.wvImageCount);e.vm.loadedScrollbarDistanceFromRight=100-t+"%"}function o(){var t=Math.ceil(100*(e.vm.wvImageIndex+1)/e.vm.wvImageCount);e.vm.loadingScrollbarDistanceFromRight=100-t+"%"}e.vm.loadedScrollbarDistanceFromRight="0%",e.vm.loadingScrollbarDistanceFromRight="0%",e.$watchGroup(["vm.wvShownImageIndex","vm.wvImageCount"],i),e.$watchGroup(["vm.wvImageIndex","vm.wvImageCount"],o)}var n={templateUrl:"app/overlay/scrollbar-overlay-item.directive.html",bindToController:!0,controller:t,controllerAs:"vm",link:e,restrict:"E",scope:{wvImageCount:"=",wvShownImageIndex:"=",wvImageIndex:"="}};return n}function t(){}angular.module("webviewer").directive("wvScrollbarOverlayItem",e)}(),function(){"use strict";function e(e){function t(t,n){var i=n.SlicesShort.map(function(e){for(var t=e[0],n=e[2],i=[],o=0;n>o;++o)i.push(t+":"+o);return i}),o=i.filter(function(e){return 1===e.length}).length===i.length;if(o)var r=[_.flatten(i)];else var r=i;var a=r.map(function(n,i){var o=t.ID+":"+i,r=t.MainDicomTags;return new e(o,n,r)});return a}var n={process:t};return n}e.$inject=["WvSerie"],angular.module("webviewer").factory("wvOrthancSerieAdapter",e)}(),function(){"use strict";function e(e,t,n,i){function o(e){var t=e.split(":"),n=t[0],i=t[1]||0;return s.listFromOrthancSerieId(n).then(function(e){return e[i]})}function r(o){var r=t.get(n.orthancApiURL+"/series/"+o),a=t.get(n.orthancApiURL+"/series/"+o+"/ordered-slices");return e.all({orthancSerie:r,orthancOrderedInstances:a}).then(function(e){var t=e.orthancSerie.data,n=e.orthancOrderedInstances.data;return i.process(t,n)})}function a(i){return t.get(n.orthancApiURL+"/studies/"+i).then(function(t){var n=t.data,i=n.Series,o=i.map(function(e){return s.listFromOrthancSerieId(e)});return e.all(o)}).then(function(e){return e=_.flatten(e)})}var s={get:o,listFromOrthancSerieId:r,listFromOrthancStudyId:a};return s}e.$inject=["$q","$http","wvConfig","wvOrthancSerieAdapter"],angular.module("webviewer").factory("wvSerieManager",e)}(),function(){"use strict";function e(e,t,n,i){function o(e,t,i){var o=this;this.id=e,this.imageIds=t,this.imageCount=t.length,this.currentIndex=0,this.currentShownIndex=0,this.tags=i,this.onCurrentImageIdChanged=new osimis.Listener,this.onAnnotationChanged=new osimis.Listener,this._annotationGroup=null,n.onAnnotationChanged(function(e){-1!==o.imageIds.indexOf(e.imageId)&&(o._annotationGroup=null,o.onAnnotationChanged.trigger(e))}),this.isPlaying=!1,this._playTimeout=null}o.prototype._loadAnnotationGroup=function(){if(!this._annotationGroup){var e=[];this.imageIds.forEach(function(t){e.push(n.getByImageId(t))}),this._annotationGroup=new i(e)}return this._annotationGroup},o.prototype.getAnnotedImageIds=function(e){return this._loadAnnotationGroup().filterByType(e).getImageIds()},o.prototype.getAnnotationGroup=function(e){return this._loadAnnotationGroup()},o.prototype.getAnnotations=function(e){var t=this._loadAnnotationGroup();return e&&t.filterByType(e),t.toArray()},o.prototype.getIndexOf=function(e){return this.imageIds.indexOf(e)},o.prototype.setShownImage=function(e){this.currentShownIndex=this.getIndexOf(e)},o.prototype.getCurrentImageId=function(){return this.imageIds[this.currentIndex]},o.prototype.goToNextImage=function(e){e!==!0&&(e=!1),this.currentIndex++,this.currentIndex>=this.imageCount&&(this.currentIndex=e?0:this.imageCount-1),this.onCurrentImageIdChanged.trigger(this.getCurrentImageId(),this.setShownImage.bind(this))},o.prototype.goToPreviousImage=function(){this.currentIndex--,this.currentIndex<0&&(this.currentIndex=0),this.onCurrentImageIdChanged.trigger(this.getCurrentImageId(),this.setShownImage.bind(this))},o.prototype.goToImage=function(e){if(0>e)e=0;else if(e+1>this.imageCount)return;this.currentIndex=e,this.onCurrentImageIdChanged.trigger(this.getCurrentImageId(),this.setShownImage.bind(this))};var r=null;return o.prototype.play=function(t){var n=this;if(t=t||1e3/30,!this.isPlaying){var i=null,o=0;!function a(){r=requestAnimationFrame(function(r){if(o)--o;else{var s=1e3/(r-i);o=Math.round(s/t),e.$apply(function(){n.goToNextImage(!0)})}i=r,n.isPlaying&&a()})}(),this.isPlaying=!0}},o.prototype.pause=function(){r&&(cancelAnimationFrame(r),r=null),this.isPlaying=!1},o}e.$inject=["$rootScope","$timeout","wvAnnotationManager","WvAnnotationGroup"],angular.module("webviewer").factory("WvSerie",e)}(),angular.module("webviewer").directive("wvSerielist",["wvSerieManager",function(e){return{scope:{wvStudy:"=",wvClassTmp:"=?wvClass"},templateUrl:"app/serielist/serielist.directive.html",restrict:"E",transclude:!0,link:function(t,n,i){function o(n,i){n&&e.listFromOrthancStudyId(n).then(function(e){t.serieIds=e.map(function(e){return e.id})})}function r(){t.wvClass=t.wvClassTmp||{};var e={ul:t.wvClass.ul||"wv-serielist",li:t.wvClass.li||"wv-serielist-item",overlay:t.wvClass.ul||"wv-serielist-overlay"};t.wvClass=e}t.$watchCollection("wvClassTmp",function(){r()}),t.$watch("wvStudy.id",o),t.serieIds=[]}}}]),angular.module("webviewer").directive("wvSplitpane",["$","$timeout",function(e,t){return{scope:{wvLayout:"=?",wvSettings:"=?"},templateUrl:"app/splitpane/splitpane.directive.html",restrict:"E",transclude:!0,link:function(n,i,o,r,a){function s(i,o){i&&(n.x=[i.x],n.y=[i.y],n.rowHeight=100/i.y+"%",n.rowWidth=100/i.x+"%",t(function(){e(window).resize()}))}n.showDefaultContent=!1,a(function(e){_.filter(e,function(e){return e instanceof HTMLElement||_.trim(e.textContent).length}).length||(n.showDefaultContent=!0)}),n.wvLayout=n.wvLayout||n.wvSettings&&n.wvSettings.layout||{x:1,y:1},n.$watch("wvLayout",s,!0)}}}]),angular.module("webviewer").directive("wvToolbarSetting",["_",function(e){return{scope:!0,templateUrl:"app/toolbar/wv-toolbar-setting.tpl.html",restrict:"E",link:function(t,n,i){t.wvName=i.wvName,t.wvIcon=i.wvIcon,t.wvChoices=e.map(t.$eval(i.wvChoices),function(e,t){return{value:e,label:t}})}}}]),angular.module("webviewer").directive("wvToolbarState",function(){return{require:["^^wvToolbar"],scope:!0,templateUrl:"app/toolbar/wv-toolbar-state.tpl.html",restrict:"E",link:function(e,t,n){e.wvName=n.wvName,e.wvIcon=n.wvIcon,e.wvIconOn=n.wvIconOn,e.wvIconOff=n.wvIconOff},controller:function(){}}}),angular.module("webviewer").directive("wvToolbarTool",function(){return{require:["^^wvToolbar"],scope:!0,templateUrl:"app/toolbar/wv-toolbar-tool.tpl.html",restrict:"E",link:function(e,t,n){e.wvName=n.wvName,e.wvIcon=n.wvIcon},controller:function(){}}}),angular.module("webviewer").directive("wvToolbar",["_",function(e){return{scope:{wvItems:"=",activeTool:"=?wvActiveTool"},templateUrl:"app/toolbar/wv-toolbar.tpl.html",transclude:!0,restrict:"E",link:function(e,t,n){},controller:["$timeout","$scope",function(t,n){n.activeTool=n.activeTool||"windowing",n.activeStates={},n.splitpaneConfig={x:1,y:1},n.$watch("activeTool",function(e,i){n.wvItems.hasOwnProperty(i)&&(n.wvItems[i]=!1),t(function(){n.wvItems[e]=!0})}),n.$watchCollection("activeStates",function(t){e.forEach(t,function(e,t){n.wvItems.hasOwnProperty(t)&&(n.wvItems[t]=e)})}),n.activeButton=null,void 0!=n.wvItems&&e.size(n.wvItems)||(n.wvItems={windowing:!0,zoom:!1,pan:!1,invert:!1,lengthmeasure:!1,anglemeasure:!1,pixelprobe:!1,ellipticalroi:!1,rectangleroi:!1,layout:{x:1,y:1},play:!1,overlay:!0}),this.set=function(e){var i=n.activeButton,o=e;i!=o&&(null!==i&&n.$broadcast("toolbar.deactivated",i),n.activeButton=o,null!==o&&t(function(){n.$broadcast("toolbar.activated",o)}))},this.get=function(){return n.activeButton}}]}}]),function(e){"use strict";function t(){function e(e,n){var i=n||e,o=n&&e;o&&(i.namespace=o),t.push(i)}var t=[],i=0;return e.once=function(t){var n=i++;e(".<_^_>. ]MONDOSHAWANS"+n+"[ .<_^_>.",function(){t.apply(this,arguments),e.close(".<_^_>. ]MONDOSHAWANS"+n+"[ .<_^_>.")})},e.close=function(e){e?_.remove(t,function(t){return t.namespace&&n(t.namespace,e)}):t=[]},e.ignore=function(e,i){t.forEach(function(t){n(t.namespace,e)&&(t.ignore=!0)}),i(),t.forEach(function(t){n(t.namespace,e)&&(t.ignore=!1)})},e.trigger=function(){var e=Array.prototype.splice.call(arguments,0);t.filter(function(e){return!e.ignore}).forEach(function(t){t.apply(null,e)})},e}function n(e,t){return _.isArray(e)&&_.isArray(t)?_.isEqualWith(e,t,function(e,t){return e.length===t.length&&e.reduce(function(e,n,i){return e&&n===t[i]},!0)}):e===t}e.Listener=t}(window.osimis||(window.osimis={})),function(){"use strict";function e(e,n,i){function r(e,t,r,a){if(t.parent().length){var s=n(r.wvSize);e.$watch(s,function(e,t){var n=e.width,i=e.height;"undefined"!=typeof n&&"undefined"!=typeof i&&a.updateSize(n,i)},!0);var l=i(function(){e.$apply(function(){var t=s(e);(o(t.width)||o(t.height))&&a.updateSize(t.width,t.height)})},10);$(window).on("resize",l),e.$on("$destroy",function(){$(window).off("resize",l)})}}var a={controller:t,link:{pre:r},restrict:"A",scope:!1,require:"wvSize",priority:100};return a}function t(e,t,a,s,l){var c=t(s.wvSize),u=[];this.onUpdate=function(t){return u.push(t),function(){e.pull(u,t)}},this.updateSize=function(e,t){var r=null,s=c.assign;if(s&&s(a,{width:e,height:t}),o(e)){if(r=r||l.closest("[wv-size-tag]"),!r.length)throw new Error("wv-size#updateSize: [wv-size-tag] not found");e=r.width()+"px"}if(o(t)){if(r=r||l.closest("[wv-size-tag]"),!r.length)throw new Error("wv-size#updateSize: [wv-size-tag] not found");t=r.height()+"px"}if(n(e)&&n(t))this.setSpecificWidthAndSpecificHeight(e,t);else if(n(e)&&i(t))this.setSpecificWidthAndScaleHeight(e,t);else{if(!n(t)||!i(e))throw new Error("wv-size: unsupported options");this.setSpecificHeightAndScaleWidth(t,e)}},this.setWidth=function(e){var t=c(a).height;this.updateSize(e,t)},this.setHeight=function(e){var t=c(a).width;this.updateSize(t,e)},this.getWidthInPixel=function(){var e=c(a).width;return r(e)?+e.replace("px",""):+l.width()},this.getHeightInPixel=function(){var e=c(a).height;return r(e)?+e.replace("px",""):+l.height()},this.setSpecificWidthAndSpecificHeight=function(e,t){l.css("width",e),l.css("height",t),u.forEach(function(e){e()})},this.setSpecificWidthAndScaleHeight=function(e,t){var n=e.replace(/^([0-9]+)(\w+)$/,function(e,n,i){return n*t+i});l.css("width",e),l.css("height",n),u.forEach(function(e){e()})},this.setSpecificHeightAndScaleWidth=function(e,t){var n=e.replace(/^([0-9]+)(\w+)$/,function(e,n,i){return n*t+i});l.css("height",e),l.css("width",n),u.forEach(function(e){e()})}}function n(e){return _.isString(e)&&e.match(/^[0-9]+\w+$/)}function i(e){return _.isNumber(e)}function o(e){return _.isString(e)&&"[wv-size-tag]"===e}function r(e){return _.isString(e)&&e.match(/^[0-9]+(px)?$/)}e.$inject=["$timeout","$parse","debounce"],t.$inject=["_","$parse","$scope","$attrs","$element"],angular.module("webviewer").directive("wvSize",e)}(),angular.module("webviewer").directive("wvStudylist",["$http","wvConfig",function(e,t){return{scope:{wvSelectedStudy:"="},template:['<button type="button" class="btn btn-default wv-studylist" ','ng-model="wvSelectedStudy" placeholder="Study.." ','bs-options="study.value as study.label for study in studies"'," bs-select>","</button>"].join(""),restrict:"E",link:function(n,i,o){n.studies=[],e.get(t.orthancApiURL+"/studies/").then(function(i){var o=i.data;n.studies=o.map(function(e){return{label:"?",value:{id:e}}}),n.studies.forEach(function(n){e.get(t.orthancApiURL+"/studies/"+n.value.id).then(function(e){var t=e.data;n.label=t.MainDicomTags.StudyDescription})})})}}}]),function(){"use strict";function e(e,t){function n(t,n,i,o){var r=e(i.wvAngleMeasureViewportTool);t.$watch(r,function(e){e?o.activate():o.deactivate()})}function i(){t.call(this,"angle")}var o={require:"wvAngleMeasureViewportTool",controller:i,link:n,restrict:"A",scope:!1};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,o}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvAngleMeasureViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvAngleMeasureViewportTool="?^wvAngleMeasureViewportTool",e}])}])}(),function(){"use strict";function e(e,t,n,i,o,r){function a(e){this.viewports=[],this.toolName=e,this.isActivated=!1}a.prototype.register=function(e){this.viewports.push(e),this._listenModelChange(e),this.isActivated&&this.activate(e)},a.prototype.unregister=function(e){this._unlistenModelChange(e),i.pull(this.viewports,e)},a.prototype._activateInputs=function(e){var t=e.getEnabledElement();o.mouseInput.enable(t),o[this.toolName].activate(t,!0)},a.prototype._deactivateInputs=function(e){var t=e.getEnabledElement();o[this.toolName].deactivate(t),o.mouseInput.disable(t)};return a.prototype._listenModelChange=function(e){var t=this,n=(this.toolName,e.getEnabledElement()),i=o.getElementToolStateManager(n),r=e.getImage(),a=r.getAnnotations(t.toolName);a&&i.restoreStateByToolAndImageId(a.type,a.imageId,a.data,!1),r.onAnnotationChanged([t,e],function(e){e.type===t.toolName&&i.restoreStateByToolAndImageId(e.type,e.imageId,e.data,!0)}),e.onImageChanging(this,function(n,o){o&&o.onAnnotationChanged.close([t,e]);var r=n.getAnnotations(t.toolName);r&&i.restoreStateByToolAndImageId(r.type,r.imageId,r.data,!1),n.onAnnotationChanged([t,e],function(e){e.type===t.toolName&&i.restoreStateByToolAndImageId(e.type,e.imageId,e.data,!0)})})},a.prototype._unlistenModelChange=function(e){var t=e.getImage();t&&t.onAnnotationChanged.close([this,e]),e.onImageChanging.close(this)},a.prototype._listenViewChange=function(t){var r=this,a=t.getEnabledElement(),s=o.getElementToolStateManager(a);n(a).on("CornerstoneImageRendered."+this.toolName,i.debounce(function(){var n=t.getImage(),o=s.getStateByToolAndImageId(r.toolName,n.id),a=n.getAnnotations(r.toolName);a&&i.isEqual(o,a.data)||e.$apply(function(){var e=i.clone(o);n.onAnnotationChanged.ignore([r,t],function(){e&&e.data.length?n.setAnnotations(r.toolName,e):e&&!e.data.length&&n.setAnnotations(r.toolName,null)})})},20))},a.prototype._unlistenViewChange=function(e){var t=e.getEnabledElement();n(t).off("CornerstoneImageRendered."+this.toolName)},a.prototype._process=function(e){},a.prototype._unprocess=function(e){},a.prototype.activate=function(e){if("undefined"==typeof e)this.viewports.forEach(this.activate.bind(this)),this.isActivated=!0;else{e.getEnabledElement();this._process(e),this._activateInputs(e),this._listenViewChange(e)}},a.prototype.deactivate=function(e){var t=this;this.viewports.forEach(function(e){t._unlistenViewChange(e),t._deactivateInputs(e),t._unprocess(e)}),this.isActivated=!1},a}e.$inject=["$rootScope","$timeout","$","_","cornerstoneTools","debounce"],angular.module("webviewer").factory("WvBaseTool",e)}(),function(){"use strict";function e(e,t,n){function i(e,n,i,o){var r=t(i.wvDefaultViewportTool);e.$watch(r,function(e){e?o.activate():o.deactivate()})}function o(t){n.call(this,"default"),this._activateInputs=function(n){var i=this,o=e(n.getEnabledElement());o.on("mousedown.dvt",function(o){var r=o.pageX,a=o.pageY,s=o.which;e(document).on("mousemove.dvt",function(o){t.$apply(function(){var e=o.pageX-r,t=o.pageY-a;r=o.pageX,a=o.pageY,1===s?i.setWindowing(n,e,t):2===s?i.pan(n,e,t):3===s&&i.zoom(n,t)}),e(document).one("mouseup",function(t){e(document).unbind("mousemove.dvt")})})})},this._deactivateInputs=function(t){var n=e(t.getEnabledElement());n.off("mousedown.dvt")},this._listenModelChange=angular.noop,this._unlistenModelChange=angular.noop,this._listenViewChange=angular.noop,this._unlistenViewChange=angular.noop,this.setWindowing=function(e,t,n){var i=e.getViewport(),o=+i.scale,r=+i.voi.windowWidth,a=+i.voi.windowCenter;i.voi.windowWidth=r+t/o,i.voi.windowCenter=a+n/o,e.setViewport(i)},this.pan=function(e,t,n){var i=e.getViewport(),o=+i.scale,r=+i.translation.x,a=+i.translation.y;i.translation.x=r+t/o,i.translation.y=a+n/o,e.setViewport(i)},this.zoom=function(e,t){var n=e.getViewport(),i=+n.scale;n.scale=i+t/100,e.setViewport(n)}}o.$inject=["$scope"];var r={require:"wvDefaultViewportTool",controller:o,link:i,restrict:"A",scope:!1};return o.prototype=Object.create(n.prototype),o.prototype.constructor=o,r}e.$inject=["$","$parse","WvBaseTool"],angular.module("webviewer").directive("wvDefaultViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvDefaultViewportTool="?^wvDefaultViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,i,o){var r=e(i.wvEllipticalRoiViewportTool);t.$watch(r,function(e){e?o.activate():o.deactivate()})}function i(){t.call(this,"ellipticalRoi")}var o={require:"wvEllipticalRoiViewportTool",controller:i,link:n,restrict:"A",scope:!1};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,o}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvEllipticalRoiViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvEllipticalRoiViewportTool="?^wvEllipticalRoiViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,i,o){var r=e(i.wvInvertContrastViewportTool);t.$watch(r,function(e){e?o.activate():o.deactivate()})}function i(){var e=this;t.call(this,"invertContrast"),this._listenViewChange=function(t){t.onViewportResetting(this,function(t){t.invert=e.isActivated})},this._unlistenViewChange=function(e){e.onViewportResetting.close(this)},this._process=function(e){var t=e.getViewport();t.invert=!0,e.setViewport(t)},this._unprocess=function(e){var t=e.getViewport();t.invert=!1,e.setViewport(t)},this._activateInputs=angular.noop,this._deactivateInputs=angular.noop,this._listenModelChange=angular.noop,this._unlistenModelChange=angular.noop}var o={require:"wvInvertContrastViewportTool",controller:i,link:n,restrict:"A",scope:!1};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,o}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvInvertContrastViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvInvertContrastViewportTool="?^wvInvertContrastViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,i,o){var r=e(i.wvLengthMeasureViewportTool);t.$watch(r,function(e){e?o.activate():o.deactivate()})}function i(){t.call(this,"length")}var o={require:"wvLengthMeasureViewportTool",controller:i,link:n,restrict:"A",scope:!1};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,o}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvLengthMeasureViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvLengthMeasureViewportTool="?^wvLengthMeasureViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,i,o){var r=e(i.wvPanViewportTool);t.$watch(r,function(e){e?o.activate():o.deactivate()})}function i(e){t.call(this,"pan"),this._activateInputs=function(t){var n=this,i=$(t.getEnabledElement());i.on("mousedown.pan",function(i){var o=i.pageX,r=i.pageY,a=i.which;$(document).on("mousemove.pan",function(i){e.$apply(function(){var e=i.pageX-o,s=i.pageY-r;o=i.pageX,r=i.pageY,1===a&&n.pan(t,e,s)}),$(document).one("mouseup",function(e){$(document).unbind("mousemove.pan")})})})},this._deactivateInputs=function(e){var t=$(e.getEnabledElement());t.off("mousedown.pan")},this._listenModelChange=angular.noop,this._unlistenModelChange=angular.noop,this._listenViewChange=angular.noop,this._unlistenViewChange=angular.noop,this.pan=function(e,t,n){var i=e.getViewport(),o=+i.scale,r=+i.translation.x,a=+i.translation.y;i.translation.x=r+t/o,i.translation.y=a+n/o,e.setViewport(i)}}i.$inject=["$scope"];var o={require:"wvPanViewportTool",controller:i,link:n,restrict:"A",scope:!1};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,o}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvPanViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvPanViewportTool="?^wvPanViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,i,o){var r=e(i.wvPixelProbeViewportTool);t.$watch(r,function(e){e?o.activate():o.deactivate()})}function i(){t.call(this,"probe")}var o={require:"wvPixelProbeViewportTool",controller:i,link:n,restrict:"A",scope:!1};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,o}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvPixelProbeViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvPixelProbeViewportTool="?^wvPixelProbeViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,i,o){var r=e(i.wvRectangleRoiViewportTool);t.$watch(r,function(e){e?o.activate():o.deactivate()})}function i(){t.call(this,"rectangleRoi")}var o={require:"wvRectangleRoiViewportTool",controller:i,link:n,restrict:"A",scope:!1};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,o}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvRectangleRoiViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvRectangleRoiViewportTool="?^wvRectangleRoiViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,i,o){var r=e(i.wvZoomViewportTool);t.$watch(r,function(e){e?o.activate():o.deactivate()})}function i(){t.call(this,"zoom")}var o={require:"wvZoomViewportTool",controller:i,link:n,restrict:"A",scope:!1};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,o}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvZoomViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvZoomViewportTool="?^wvZoomViewportTool",e}])}])}(),function(){"use strict";function e(e){function n(t,n,i,o){var r=o.wvSerieId,a=o.wvViewport;r.onCurrentImageIdChanged(function(e,t,n){if(e){var i=t;a.setImage(e,i).then(function(){n&&n(e)})}else a.clearImage()});var s=e(i.wvSerieId);t.$watch(s,function(e){e?r.setSerie(e):r.clearSerie()});var l=e(i.wvOnSerieChange),c=e(i.wvSerie);r.onSerieChanged(function(e){c&&c.assign&&(c.assign(t,e),l&&l(t,{$serie:e}))}),_.filter(o,function(e,n){var i=_.endsWith(n,"SerieExt");e&&i&&(e.register(r),t.$on("$destroy",function(){e.unregister(r)}))})}var i={require:{wvSerieId:"wvSerieId",wvViewport:"wvViewport"},controller:t,link:n,restrict:"A",scope:!1};return i}function t(e){var t=this;this._serieManager=e,this._serieId=null,this._serie=null,this.onCurrentImageIdChanged=new osimis.Listener,this.onSerieChanged=new osimis.Listener,this.onSerieChanged(function(e,n){if(n&&n.onCurrentImageIdChanged.close(t),e){e.onCurrentImageIdChanged(t,function(e,n){t.onCurrentImageIdChanged.trigger(e,!1,n)});var i=e.getCurrentImageId();t.onCurrentImageIdChanged.trigger(i,!0)}else t.onCurrentImageIdChanged.trigger(null)})}e.$inject=["$parse"],
t.$inject=["wvSerieManager"],angular.module("webviewer").directive("wvSerieId",e),t.prototype.onSerieChanged=angular.noop,t.prototype.clearSerie=function(){var e=this.serie;this._serieId=null,this._serie=null,this.onSerieChanged.trigger(null,e)},t.prototype.setSerie=function(e){var t=this;this._serieId=e,this._serieManager.get(e).then(function(e){var n=t._serie;t._serie=e,t.onSerieChanged.trigger(e,n)})},t.prototype.getSerie=function(){return this._serie}}(),function(){"use strict";function e(){function e(e,t,n){}var n={controller:t,link:e,restrict:"A",scope:!1};return n}function t(e,t,n){var i=[];this.register=function(e){i.push(e)},this.unregister=function(e){_.pull(i,e)};var o=$('<div class="wv-draggable-clone"></div>');t.draggable({helper:function(){return o},start:function(e,n){var o=i[0].getSerie();if(o){var r=n.helper;r.data("serie-id",o.id),r.width(t.width()),r.height(t.height())}},zIndex:100})}t.$inject=["$scope","$element","$attrs"],angular.module("webviewer").directive("wvDraggableSerieExt",e).config(["$provide",function(e){e.decorator("wvSerieIdDirective",["$delegate",function(e){var t=e[0];return t.require.wvDraggableSerieExt="?^wvDraggableSerieExt",e}])}])}(),function(){"use strict";function e(){function e(e,t,n,i){}var n={controller:t,link:e,restrict:"A",scope:!1};return n}function t(e,t){var n=[];this.register=function(e){n.push(e)},this.unregister=function(e){_.pull(n,e)},t.droppable({accept:"[wv-draggable-serie-ext]",drop:function(t,i){var o=$(i.helper),r=o.data("serie-id");e.$apply(function(){n.forEach(function(e){e.setSerie(r)})})}})}t.$inject=["$scope","$element"],angular.module("webviewer").directive("wvDroppableSerieExt",e).config(["$provide",function(e){e.decorator("wvSerieIdDirective",["$delegate",function(e){var t=e[0];return t.require.wvDroppableSerieExt="?^wvDroppableSerieExt",e}])}])}(),function(){"use strict";function e(e){function n(t,n,i,o){var r=e(i.wvPlaySerieExt);t.$watch(r,function(e){e?o.activate():o.deactivate()})}var i={require:"wvPlaySerieExt",controller:t,link:n,restrict:"A",scope:!1};return i}function t(e,t,n){var i=this,o=[];this.isActivated=!1,this.register=function(e){o.push(e);var t=e.getSerie();this.isActivated&&t&&this.activate(t),e.onSerieChanged(this,function(e,t){t&&i.isActivated&&i.deactivate(t),e&&i.isActivated&&i.activate(e)})},this.unregister=function(e){_.pull(o,e),e.onSerieChanged.close(this);var t=e.getSerie();this.deactivate(t)},this.activate=function(e){"undefined"==typeof e?(o.forEach(function(e){var t=e.getSerie();i.activate(t)}),this.isActivated=!0):e&&!e.isPlaying&&e.play()},this.deactivate=function(e){"undefined"==typeof e?(o.forEach(function(e){var t=e.getSerie();i.deactivate(t)}),this.isActivated=!1):e&&e.isPlaying&&e.pause()}}e.$inject=["$parse"],t.$inject=["$scope","$element","$attrs"],angular.module("webviewer").directive("wvPlaySerieExt",e).config(["$provide",function(e){e.decorator("wvSerieIdDirective",["$delegate",function(e){var t=e[0];return t.require.wvPlaySerieExt="?^wvPlaySerieExt",e}])}])}(),function(){"use strict";function e(){function e(e,t,n){}var n={controller:t,link:e,restrict:"A",scope:!1};return n}function t(e,t,n){function i(){e.$apply(function(){r.forEach(function(e){var t=e.getSerie();t&&t.play(1e3/30)})})}function o(){e.$apply(function(){r.forEach(function(e){var t=e.getSerie();t&&(t.pause(),t.goToImage(0))})})}var r=[];this.register=function(e){r.push(e)},this.unregister=function(e){_.pull(r,e)},t.on("mouseover",i).on("mouseout",o),e.$on("$destroy",function(){r.forEach(function(e){var t=e.getSerie();t&&t.pause()}),t.off("mouseover",i),t.off("mouseout",o)})}t.$inject=["$scope","$element","$attrs"],angular.module("webviewer").directive("wvScrollOnOverSerieExt",e).config(["$provide",function(e){e.decorator("wvSerieIdDirective",["$delegate",function(e){var t=e[0];return t.require.wvScrollOnOverSerieExt="?^wvScrollOnOverSerieExt",e}])}])}(),function(){"use strict";function e(){function e(e,t,n){}var n={controller:t,link:e,restrict:"A",scope:!1};return n}function t(e,t,n,i){var o=[];this.register=function(e){o.push(e)},this.unregister=function(e){_.pull(o,e)},i=i(t[0]),i.wheel(function(t,n,i,r){e.$apply(function(){o.forEach(function(e){var t=e.getSerie();t&&(0>r?t.goToPreviousImage():r>0&&t.goToNextImage(!1))})}),t.preventDefault()}),e.$on("$destroy",function(){i.unwheel()})}t.$inject=["$scope","$element","$attrs","hamster"],angular.module("webviewer").directive("wvScrollOnWheelSerieExt",e).config(["$provide",function(e){e.decorator("wvSerieIdDirective",["$delegate",function(e){var t=e[0];return t.require.wvScrollOnWheelSerieExt="?^wvScrollOnWheelSerieExt",e}])}])}(),function(){"use strict";function e(e,n,i,o,r,a,s,l){function c(e,t,i,o){function r(e,n){if(!e)return n.resizeViewport(t.width(),t.height()),null;var i=e&&e.onUpdate(function(){var t=e.getWidthInPixel(),i=e.getHeightInPixel();n.resizeViewport(t,i)});return function(){i()}}function a(e){n.forEach(o,function(t,i){var o=n.endsWith(i,"ViewportTool");t&&o&&e(t,i)})}var c=t.children(".wv-cornerstone-enabled-image")[0],v=new u(l,c);e.vm.wvEnableOverlay=!!e.vm.wvEnableOverlay;var w=(s(i.wvImageId),o.wvSize),p=r(w,v),g=o.wvViewport;g.getImage=function(){return v.getImageId()},g.setImage=function(t,n){return e.vm.wvImageId=t,v.setImage(t,n)},g.clearImage=function(){e.vm.wvImageId=null},e.$watch("vm.wvImageId",function(e,t){e?v.setImage(e):v.clearImage()}),v.onImageChanged(function(t){e.vm.wvImage=t,e.vm.wvOnImageChange&&e.vm.wvOnImageChange({$image:t})}),t.on("CornerstoneImageRendered",function(t,n){e.$evalAsync(function(){e.vm.wvViewport=n.viewport})}),e.$on("$destroy",function(){p&&(p(),p=null),v.destroy()}),v.onImageChanged.once(function(t){a(function(t){t.register(v),e.$on("$destroy",function(){t.unregister(v)})})})}function u(e,t){this._imageManager=e,this._enabledElement=t,this._imageId=null,this._image=null,this._viewportWidth=null,this._viewportHeight=null,this._cancelImageDisplaying=null,this.onImageChanging=new osimis.Listener,this.onImageChanged=new osimis.Listener,this.onViewportResetting=new osimis.Listener,i.enable(t)}function v(e,t,n,i){var o=i.width<=t&&i.height<=n;if(o)e.scale=1;else{var r=n/i.height,a=t/i.width;r>a?e.scale=a:e.scale=r,e.translation.x=0,e.translation.y=0}}var w={transclude:!0,bindToController:!0,controller:t,controllerAs:"vm",templateUrl:"app/viewport/viewport.directive.html",link:c,restrict:"E",require:{wvViewport:"wvViewport",wvSize:"?wvSize"},scope:{wvImageId:"=?",wvImage:"=?",wvOnImageChange:"&?",wvViewport:"=?",wvEnableOverlay:"=?"}};return u.prototype.onImageChanging=angular.noop,u.prototype.onImageChanged=angular.noop,u.prototype.destroy=function(){this._cancelImageDisplaying&&this._cancelImageDisplaying(),i.disable(this._enabledElement)},u.prototype.getEnabledElement=function(){return this._enabledElement},u.prototype.getViewport=function(){return i.getViewport(this._enabledElement)},u.prototype.setViewport=function(e){return i.setViewport(this._enabledElement,e)},u.prototype.getImageId=function(){return this._imageId},u.prototype.getImage=function(){return this._image},u.prototype.updateImage=function(e){!this.hasImage()},u.prototype.setImage=function(t,n){if(t==this._imageId&&!n)return a.reject("This image is already shown");n=n||!1,null===this._imageId&&(n=!0);var o=this;this._imageId=t,this._cancelImageDisplaying&&this._cancelImageDisplaying();var r=!1;return this._cancelImageDisplaying=function(){r=!0,o._cancelImageDisplaying=null},a.all({processedImage:o._imageManager.get(t).then(function(e){return e.getPixelObject()}),imageModel:o._imageManager.get(t)}).then(function(t){if(r)return a.reject("wv-viewport: image displaying canceled");var s,l=t.processedImage,c=t.imageModel,u=o._image;return s=n?o.resetViewport(l):i.getViewport(o._enabledElement),o.onImageChanging.trigger(c,u),i.displayImage(o._enabledElement,l,s),e(o._enabledElement).css("visibility","visible"),t}).then(function(e){if(r)return a.reject("wv-viewport: image displaying canceled");var t=e.imageModel,n=o._image;return o._image=t,o.onImageChanged.trigger(t,n),t})},u.prototype.clearImage=function(){this._imageId=null,e(this._enabledElement).css("visibility","hidden")},u.prototype.hasImage=function(){return null!==this._imageId},u.prototype.resizeViewport=function(t,n){var o=e(this._enabledElement);this._viewportWidth=t,this._viewportHeight=n,o.width(t),o.height(n),i.resize(this._enabledElement,!1);var r=i.getImage(this._enabledElement),a=i.getViewport(this._enabledElement);r&&a&&(v(a,this._viewportWidth,this._viewportHeight,r),i.displayImage(this._enabledElement,r,a))},u.prototype.resetViewport=function(e){var t=i.getDefaultViewportForImage(this._enabledElement,e);return v(t,this._viewportWidth,this._viewportHeight,e),this.onViewportResetting.trigger(t),t},w}function t(e,t,n,i){this.getImage=angular.noop,this.setImage=angular.noop,this.clearImage=angular.noop}e.$inject=["$","_","cornerstone","cornerstoneTools","$rootScope","$q","$parse","wvImageManager"],t.$inject=["$scope","$element","cornerstone","wvImageManager"],angular.module("webviewer").directive("wvViewport",e).run(["cornerstoneTools",function(e){var t=e.newImageIdSpecificToolStateManager();t.getStateByToolAndImageId=function(e,t){return this.toolState[t]&&this.toolState[t][e]},t.restoreStateByToolAndImageId=function(e,t,n,i){if("undefined"==typeof i&&(i=!0),this.toolState[t]=this.toolState[t]||{},this.toolState[t][e]=n,i){var o=cornerstone.getEnabledElementsByImageId(t);o.forEach(function(e){var t=e.element;cornerstone.draw(t)})}},e.globalImageIdSpecificToolStateManager=t}])}(),angular.module("webviewer").run(["$templateCache",function(e){e.put("app/overlay/overlay.directive.html","<div class=wv-overlay ng-transclude><div class=wv-overlay-topleft ng-if=vm.showTopLeftArea()>{{vm.wvTags.PatientName}}<br>{{vm.wvTags.PatientID}}</div><div class=wv-overlay-topright ng-if=vm.showTopRightArea()>{{vm.wvTags.StudyDescription}}<br>{{vm.wvTags.StudyDate}}<br>#{{vm.wvTags.SeriesNumber}} - {{vm.wvTags.SeriesDescription}}<br></div><div class=wv-overlay-bottomright ng-if=vm.showBottomRightArea()>zoom: {{vm.wvViewport.scale|number:2}}<br>ww/wc: {{vm.wvViewport.voi.windowWidth|number:0}}/{{vm.wvViewport.voi.windowCenter|number:0}}</div><wv-scrollbar-overlay-item wv-image-count=vm.wvSerie.imageCount wv-image-index=vm.wvSerie.currentIndex wv-shown-image-index=vm.wvSerie.currentShownIndex ng-if=vm.wvShowTimeline></wv-scrollbar-overlay-item></div>"),e.put("app/overlay/scrollbar-overlay-item.directive.html",'<div><div class=wv-overlay-scrollbar-text>{{vm.wvShownImageIndex + 1}}/{{vm.wvImageCount}}<br></div><div class=wv-overlay-scrollbar-loading ng-style="{ right: vm.loadingScrollbarDistanceFromRight }"></div><div class=wv-overlay-scrollbar-loaded ng-style="{ right: vm.loadedScrollbarDistanceFromRight }"></div></div>'),e.put("app/serielist/serielist.directive.html","<ul class={{wvClass.ul}}><li ng-repeat=\"id in serieIds\" class={{wvClass.li}} ng-transclude wv-size-tag><wv-viewport wv-serie-id=id wv-image=$image wv-size=\"{width: '[wv-size-tag]', height: '[wv-size-tag]'}\" wv-draggable-serie-ext wv-scroll-on-over-serie-ext><wv-overlay wv-tags=$image.tags><div class=wv-serielist-overlay>{{$image.tags.SeriesDescription}}</div></wv-overlay></wv-viewport></li></ul>"),e.put("app/splitpane/splitpane.directive.html",'<div class=wv-splitpane><div ng-repeat="$y in y | range track by $index" class=wv-splitpane-row ng-style="{height: rowHeight}"><div ng-repeat="$x in x | range track by $index" class=wv-splitpane-cell ng-style="{width: rowWidth}" wv-size-tag><ng-transclude></ng-transclude><div ng-if=showDefaultContent><wv-viewport wv-serie-id=randomSerieId wv-size="{width: \'[wv-size-tag]\', height:\'[wv-size-tag]\'}" wv-droppable-serie-ext wv-scroll-on-wheel-serie-ext wv-enable-overlay="!wvSettings || wvSettings.hasOwnProperty(\'overlay\') == false || wvSettings.overlay" wv-default-viewport-tool=wvSettings.windowing wv-angle-measure-viewport-tool=wvSettings.anglemeasure wv-length-measure-viewport-tool=wvSettings.lengthmeasure wv-elliptical-roi-viewport-tool=wvSettings.ellipticalroi wv-zoom-viewport-tool=wvSettings.zoom wv-pan-viewport-tool=wvSettings.pan wv-pixel-probe-viewport-tool=wvSettings.pixelprobe wv-rectangle-roi-viewport-tool=wvSettings.rectangleroi wv-invert-contrast-viewport-tool=wvSettings.invert wv-play-serie-ext=wvSettings.play></wv-viewport></div></div></div></div>'),e.put("app/toolbar/wv-toolbar-setting.tpl.html",'<button type=button class="btn btn-sm btn-default wv-toolbar-item" html=1 placeholder="<span class=&quot;fa fa-th-large&quot;></span>" icon-checkmark="fa fa-th-large" bs-options="item.value as item.label for item in wvChoices" ng-model=wvItems[wvName] bs-select ng-if=wvItems.hasOwnProperty(wvName)></button>'),e.put("app/toolbar/wv-toolbar-state.tpl.html",'<label class="btn btn-sm btn-default wv-toolbar-item" ng-class="wvIcon || ($parent.$parent.activeStates[wvName] ? wvIconOn : wvIconOff)" ng-if=wvItems.hasOwnProperty(wvName)><input type=checkbox value={{wvName}} style="display: none;" ng-model=$parent.$parent.activeStates[wvName] bs-checkbox></label>'),e.put("app/toolbar/wv-toolbar-tool.tpl.html",'<label class="btn btn-sm btn-default wv-toolbar-item" ng-if=wvItems.hasOwnProperty(wvName)><span ng-class=wvIcon></span> <input type=radio value={{wvName}} style="display: none;" ng-model=$parent.$parent.activeTool bs-radio></label>'),e.put("app/toolbar/wv-toolbar.tpl.html",'<div class="wv-toolbar btn-toolbar" role=toolbar style="margin-left: 0;" ng-transclude ng-init="wvItems = wvItems || $parent.wvItems"><div class=wv-toolbar-settings><wv-toolbar-setting wv-name=layout wv-icon="fa fa-th-large" wv-choices="{ \'1x1\': {x: 1, y: 1}, \'2x1\': {x: 2, y: 1}, \'1x2\': {x: 1, y: 2}, \'2x2\': {x: 2, y: 2} }"></wv-toolbar-setting></div><div class=wv-toolbar-states><wv-toolbar-state wv-name=invert wv-icon="fa fa-adjust"></wv-toolbar-state><wv-toolbar-state wv-name=play wv-icon-on="fa fa-pause" wv-icon-off="fa fa-play"></wv-toolbar-state></div><div class=wv-toolbar-tools><wv-toolbar-tool wv-name=windowing wv-icon="fa fa-sun-o"></wv-toolbar-tool><wv-toolbar-tool wv-name=zoom wv-icon="fa fa-search"></wv-toolbar-tool><wv-toolbar-tool wv-name=pan wv-icon="fa fa-arrows"></wv-toolbar-tool><wv-toolbar-tool wv-name=lengthmeasure wv-icon="fa fa-arrows-v"></wv-toolbar-tool><wv-toolbar-tool wv-name=anglemeasure wv-icon="fa fa-angle-left"></wv-toolbar-tool><wv-toolbar-tool wv-name=pixelprobe wv-icon="fa fa-dot-circle-o"></wv-toolbar-tool><wv-toolbar-tool wv-name=ellipticalroi wv-icon="fa fa-circle-o"></wv-toolbar-tool><wv-toolbar-tool wv-name=rectangleroi wv-icon="fa fa-square-o"></wv-toolbar-tool></div><div class=wv-toolbar-end></div></div>'),e.put("app/viewport/viewport.directive.html",'<div class="cornerstone-enabled-image wv-cornerstone-enabled-image" oncontextmenu="return false" unselectable=on onselectstart="return false;" onmousedown="return false;" style="position: relative;"><ng-transclude><wv-overlay wv-tags=vm.wvImage.tags wv-viewport=vm.wvViewport ng-if=vm.wvEnableOverlay></wv-overlay></ng-transclude></div>')}]);