/**
 * webViewer - webViewer Project Generated from OsimisAngular
 * @authors 
 * @version v0.0.1
 * @link 
 * @license 
 */
!function(){"use strict";var e="0.2.9";angular.module("webviewer",["ngResource","ngSanitize","mgcrea.ngStrap","ngRangeFilter","debounce"]).constant("$",window.$).constant("_",window._).constant("pako",window.pako).constant("JpegImage",window.JpegImage).constant("hamster",window.Hamster).constant("cornerstone",window.cornerstone).constant("cornerstoneTools",window.cornerstoneTools).provider("wvConfig",function(){var t={version:e,orthancApiURL:"",webviewerApiURL:"web-viewer",defaultCompression:"jpeg95"};this.setApiURL=function(e){"/"===e.substr(-1)&&(e=e.substr(0,e.length-1)),t.orthancApiURL=e,t.webviewerApiURL=e+"/web-viewer"},this.$get=function(){return t}}).config(["$httpProvider",function(e){e.defaults.cache=!0}])}(),function(){"use strict";function e(e,t){e.registerImageLoader("orthanc",function(e){return e=e.replace("orthanc://",""),t.getCompressedImage(e)})}function t(e,t,n,o,r){function a(t){return r.getCompressedImage(t).then(function(n){return n.imageId=t,n.color?n.render=o.renderColorImage:n.render=o.renderGrayscaleImage,n.getPixelData=e.memoize(i),n})}var l={getCompressedImage:e.memoize(a)};return l}function n(e,t,n,o,i){for(var r=(i-n)/(o-t),a=n-r*t,l=0,s=e.length;s>l;l++)e[l]=r*e[l]+a}function o(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),o=0,i=e.length;i>o;o++)n[o]=e.charCodeAt(o);return n}function i(){switch(this.Orthanc.Compression){case"Deflate":return r(this);case"Jpeg":return a(this);default:throw new Error("unknown compression")}}function r(e){var t,n,o,i=pako.inflate(window.atob(e.Orthanc.PixelData)),r=null;if(e.color)for(t=new ArrayBuffer(i.length/3*4),r=new Uint8Array(t),n=0,o=0;o<i.length;o+=3)r[n++]=i[o],r[n++]=i[o+1],r[n++]=i[o+2],r[n++]=255;else for(t=new ArrayBuffer(2*i.length),r=new Int16Array(t),n=0,o=0;o<i.length;o+=2){var a=i[o],l=i[o+1];r[n]=a+256*l,n++}return r}function a(e){var t=new JpegImage,i=o(window.atob(e.Orthanc.PixelData));t.parse(i);var r,a,l,s=t.getData(e.width,e.height),c=null;if(e.color)for(r=new ArrayBuffer(s.length/3*4),c=new Uint8Array(r),a=0,l=0;l<s.length;l+=3)c[a++]=s[l],c[a++]=s[l+1],c[a++]=s[l+2],c[a++]=255;else{for(r=new ArrayBuffer(2*s.length),c=new Int16Array(r),a=0,l=0;l<s.length;l++)c[a]=s[l],a++;e.Orthanc.Stretched&&n(c,0,e.Orthanc.StretchLow,255,e.Orthanc.StretchHigh)}return c}e.$inject=["cornerstone","wvCornerstoneLoader"],t.$inject=["_","pako","JpegImage","cornerstone","wvImage"],angular.module("webviewer").factory("wvCornerstoneLoader",t).run(e)}(),function(){"use strict";function e(){function e(e,t){this.id=e,this.tags=t,this.annotations={},this.onAnnotationChanged=new osimis.Listener}return e.prototype.getAnnotations=function(e){return this.annotations[e]},e.prototype.setAnnotations=function(e,t){this.annotations[e]=t,this.onAnnotationChanged.trigger(e,t)},e}angular.module("webviewer").factory("WVImageModel",e)}(),function(){"use strict";function e(e,t,n,o){function i(t){var i=t.split(":"),r=i[0];i[1]||0;return e.get(n.orthancApiURL+"/instances/"+r+"/simplified-tags").then(function(e){var n=e.data;return new o(t,n)})}function r(t){var o=n.defaultCompression;t=t.split(":");var i=t[0],r=t[1];return e.get(n.webviewerApiURL+"/instances/"+o+"-"+i+"_"+r).then(function(e){return e.data})}var a={get:i,getCompressedImage:r};return a}e.$inject=["$http","$q","wvConfig","WVImageModel"],angular.module("webviewer").factory("wvImage",e)}(),function(){"use strict";function e(e){function n(t,n,o,i){var r=e(o.wvAngleMeasureViewportTool);t.$watch(r,function(e){e?i.activate():i.deactivate()})}var o={require:"wvAngleMeasureViewportTool",controller:t,link:n,restrict:"A",scope:!1};return o}function t(e,t,n,o,i,r){function a(e){var a=i.getElementToolStateManager(e);i.mouseInput.enable(e),i[c.toolName].activate(e,!0),n(e).on("CornerstoneImageRendered.tool",r(function(){t(function(){var e=o.clone(a.getStateByToolAndImageId(c.toolName,v.id));v.onAnnotationChanged.ignore(c,function(){v.setAnnotations(c.toolName,e)})})},20))}function l(e){n(e).off(".tool"),i[c.toolName].deactivate(e),i.mouseInput.disable(e)}function s(e,t){var n=c.toolName;u.forEach(function(o){var r=i.getElementToolStateManager(o);r.restoreStateByToolAndImageId(n,e,t)})}var c=this,u=[],v=null;this.toolName="angle",this.isActivated=!1,this.register=function(e,t){u.push(e),this.setCurrentImage(t),this.isActivated&&a(e)},this.setCurrentImage=function(e){var t=v;t&&t.onAnnotationChanged.close(this);var n=e.getAnnotations(c.toolName);n&&s(e.id,n),e.onAnnotationChanged(this,function(t,n){t===c.toolName&&s(e.id,n)}),v=e},this.unregister=function(e){o.pull(u,e)},this.activate=function(){u.forEach(function(e){a(e)}),this.isActivated=!0},this.deactivate=function(){u.forEach(function(e){l(e)}),this.isActivated=!1}}e.$inject=["$parse"],t.$inject=["$rootScope","$timeout","$","_","cornerstoneTools","debounce"],angular.module("webviewer").directive("wvAngleMeasureViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvAngleMeasureViewportTool="?^wvAngleMeasureViewportTool",e}])}])}(),angular.module("webviewer").directive("wvStateInvert",["$parse",function(e){return{scope:!1,restrict:"A",link:function(t,n,o){function i(e){"undefined"!=typeof e&&r.$broadcast("viewport:SetViewport",{execute:function(e){return e.invert=this.invert,e},invert:e})}var r=angular.element(n).isolateScope()||t,a=e(o.wvStateInvert);t.$on("viewport:ViewportLoaded",function(){i(a(t))}),t.$watch(a,i)}}}]),angular.module("webviewer").directive("wvToolEllipticalroi",["$parse",function(e){return{scope:!1,restrict:"A",link:function(t,n,o){function i(e){"undefined"!=typeof e&&(e?r.$broadcast("viewport:ActivateTool",{tool:"ellipticalRoi",arguments:[!0]}):r.$broadcast("viewport:DeactivateTool",{tool:"ellipticalRoi"}))}var r=angular.element(n).isolateScope()||t,a=e(o.wvToolEllipticalroi);t.$on("viewport:ViewportLoaded",function(){i(a(t))}),t.$watch(a,i)}}}]),angular.module("webviewer").directive("wvToolLengthmeasure",["$parse",function(e){return{scope:!1,restrict:"A",link:function(t,n,o){function i(e){"undefined"!=typeof e&&(e?r.$broadcast("viewport:ActivateTool",{tool:"length",arguments:[!0]}):r.$broadcast("viewport:DeactivateTool",{tool:"length"}))}var r=angular.element(n).isolateScope()||t,a=e(o.wvToolLengthmeasure);t.$on("viewport:ViewportLoaded",function(){i(a(t))}),t.$watch(a,i)}}}]),angular.module("webviewer").directive("wvToolPan",["$","$parse",function(e,t){return{scope:!1,restrict:"A",link:function(n,o,i){function r(t){var o=t.pageX,i=t.pageY,r=t.which,a=this.ctrl;t.stopImmediatePropagation(),e(document).mousemove(function(e){n.$apply(function(){var t=e.pageX-o,n=e.pageY-i;if(o=e.pageX,i=e.pageY,1===r){var l={execute:function(e){var t=e.scale;return e.translation.x=+e.translation.x+this.deltaX/t,e.translation.y=+e.translation.y+this.deltaY/t,e},deltaX:t,deltaY:n};a.setViewport(l)}})}),e(document).mouseup(function(t){e(document).unbind("mousemove"),e(document).unbind("mouseup")})}function a(e){"undefined"!=typeof e&&(e?l.$broadcast("viewport:ListenDomEvent",{evt:"mousedown",fn:r}):l.$broadcast("viewport:UnlistenDomEvent",{evt:"mousedown",fn:r}))}var l=angular.element(o).isolateScope()||n,s=t(i.wvToolPan);n.$on("viewport:ViewportLoaded",function(){a(s(n))}),n.$watch(s,a)}}}]),angular.module("webviewer").directive("wvToolPixelprobe",["$parse",function(e){return{scope:!1,restrict:"A",link:function(t,n,o){function i(e){"undefined"!=typeof e&&(e?r.$broadcast("viewport:ActivateTool",{tool:"probe",arguments:[!0]}):r.$broadcast("viewport:DeactivateTool",{tool:"probe"}))}var r=angular.element(n).isolateScope()||t,a=e(o.wvToolPixelprobe);t.$on("viewport:ViewportLoaded",function(){i(a(t))}),t.$watch(a,i)}}}]),angular.module("webviewer").directive("wvToolRectangleroi",["$parse",function(e){return{scope:!1,restrict:"A",link:function(t,n,o){function i(e){"undefined"!=typeof e&&(e?r.$broadcast("viewport:ActivateTool",{tool:"rectangleRoi",arguments:[!0]}):r.$broadcast("viewport:DeactivateTool",{tool:"rectangleRoi"}))}var r=angular.element(n).isolateScope()||t,a=e(o.wvToolRectangleroi);t.$on("viewport:ViewportLoaded",function(){i(a(t))}),t.$watch(a,i)}}}]),angular.module("webviewer").directive("wvToolStackscroll",["$","_","$parse",function(e,t,n){return{scope:!1,restrict:"A",link:function(n,o,i){var r=angular.element(o).isolateScope(),a=function(n){var o=n.pageX,i=n.pageY,a=n.which,l=t.debounce(function(e){var t=e.pageX-o;e.pageY-i;o=e.pageX,i=e.pageY,r.$apply(function(){1===a&&t>0?r.wvInstanceIndex++:1===a&&0>t&&r.wvInstanceIndex--})},17);e(document).mousemove(function(t){l(t),e(document).mouseup(function(t){e(document).unbind("mousemove"),e(document).unbind("mouseup"),t.stopImmediatePropagation(),t.preventDefault()}),t.stopImmediatePropagation(),t.preventDefault()})};n.$watch(i.wvToolStackscroll,function(e){e?o.on("mousedown",a):o.off("mousedown",a)})}}}]),angular.module("webviewer").directive("wvToolZoom",["$parse",function(e){return{scope:!1,restrict:"A",link:function(t,n,o){function i(e){"undefined"!=typeof e&&(e?r.$broadcast("viewport:ActivateTool",{tool:"zoom",arguments:[1]}):r.$broadcast("viewport:DeactivateTool",{tool:"zoom"}))}var r=angular.element(n).isolateScope()||t,a=e(o.wvToolZoom);t.$on("viewport:ViewportLoaded",function(){i(a(t))}),t.$watch(a,i)}}}]),angular.module("webviewer").directive("wvViewportMouseEvents",["$",function(e){return{scope:!1,restrict:"A",link:function(t,n,o,i){var r=n,a=angular.element(n).isolateScope();r.mousedown(function(t){var n=t.pageX,o=t.pageY,i=t.which;e(document).mousemove(function(t){a.$apply(function(){var e=t.pageX-n,r=t.pageY-o;n=t.pageX,o=t.pageY;var l;1===i?(l={execute:function(e){var t=e.scale;return e.voi.windowWidth=+e.voi.windowWidth+this.deltaX/t,e.voi.windowCenter=+e.voi.windowCenter+this.deltaY/t,e},deltaX:e,deltaY:r},a.$broadcast("viewport:SetViewport",l)):2===i?(l={execute:function(e){var t=e.scale;return e.translation.x=+e.translation.x+this.deltaX/t,e.translation.y=+e.translation.y+this.deltaY/t,e},deltaX:e,deltaY:r},a.$broadcast("viewport:SetViewport",l)):3===i&&(l={execute:function(e){return e.scale=+e.scale+this.deltaY/100,e},deltaY:r},a.$broadcast("viewport:SetViewport",l))}),e(document).mouseup(function(t){e(document).unbind("mousemove"),e(document).unbind("mouseup")})})})}}}]),function(){"use strict";function e(e,n,o,i,r,a,l,s){function c(e,t,o,i){function r(e,n){if(!e)return n.resizeViewport(t.width(),t.height()),null;var o=e&&e.onUpdate(function(){var t=e.getWidthInPixel(),o=e.getHeightInPixel();n.resizeViewport(t,o),n.hasImage()&&n.autoScaleImage()});return function(){o()}}function a(e){n.forEach(i,function(t,o){var i=n.endsWith(o,"ViewportTool");t&&i&&e(t,o)})}var c=t.children(".wv-cornerstone-enabled-image")[0],v=new u(s,c);e.vm.wvEnableOverlay=!!e.vm.wvEnableOverlay;var w=(l(o.wvImageId),i.wvSize),d=r(w,v),g=i.wvViewport;g.getImage=function(){return v.getImageId()},g.setImage=function(t,n){var n=n||!1;return e.vm.wvImageId=t,v.setImage(t,n)},g.clearImage=function(){e.vm.wvImageId=null},e.$watch("vm.wvImageId",function(e,t){e?v.setImage(e):v.clearImage()}),v.onImageChanged(function(t){e.vm.wvTags=t.tags}),t.on("CornerstoneImageRendered",function(t,n){e.$evalAsync(function(){e.vm.wvViewport=n.viewport})}),e.$on("$destroy",function(){d&&(d(),d=null),v.destroy()}),v.onImageChanged.once(function(t){a(function(n){n.register(c,t),v.onImageChanged(n.setCurrentImage.bind(n)),e.$on("$destroy",function(){n.unregister(c)})})})}function u(e,t){this._imageRepository=e,this._enabledElement=t,this._imageId=null,this._viewportWidth=null,this._viewportHeight=null,this._imageShownPromise=null,this.onImageChanged=new osimis.Listener,o.enable(t)}var v={transclude:!0,bindToController:!0,controller:t,controllerAs:"vm",templateUrl:"app/image/viewport.directive.tpl.html",link:c,restrict:"E",require:{wvViewport:"wvViewport",wvSize:"?wvSize"},scope:{wvImageId:"=?",wvTags:"=?",wvViewport:"=?",wvEnableOverlay:"=?"}};return u.prototype.onImageChanged=angular.noop,u.prototype.destroy=function(){o.disable(this._enabledElement)},u.prototype.getImageId=function(){return this._imageId},u.prototype.setImage=function(t,n){if(t==this._imageId&&!n)return a.reject("This image is already shown");var i=this,l=null===this._imageId;return n=n||!1,this._imageId=t,this._imageShownPromise=a.when(this._imageShownPromise).then(function(){return a.all({processedImage:o.loadImage("orthanc://"+t),imageModel:i._imageRepository.get(t)})}).then(function(t){var s=t.processedImage;t.imageModel;return a(function(a,c){requestAnimationFrame(function(){r.$apply(function(){if(n){var r=o.getDefaultViewportForImage(i._enabledElement,s);o.displayImage(i._enabledElement,s,r)}else o.displayImage(i._enabledElement,s);(l||n)&&i.autoScaleImage(),e(i._enabledElement).css("visibility","visible"),a(t)})})})}).then(function(e){var t=e.imageModel;i.onImageChanged.trigger(t)}),this._imageShownPromise},u.prototype.clearImage=function(){this._imageId=null,e(this._enabledElement).css("visibility","hidden")},u.prototype.hasImage=function(){return null!==this._imageId},u.prototype.resizeViewport=function(t,n){var i=e(this._enabledElement);this._viewportWidth=t,this._viewportHeight=n,i.width(t),i.height(n),o.resize(this._enabledElement,!1)},u.prototype.autoScaleImage=function(){var e=o.getImage(this._enabledElement),t=e.width<=this._viewportWidth&&e.height<=this._viewportHeight;if(t){o.resize(this._enabledElement,!1);var n=o.getViewport(this._enabledElement);n.scale=1,o.setViewport(this._enabledElement,n)}else o.fitToWindow(this._enabledElement)},v}function t(e,t,n,o){this.getImage=angular.noop,this.setImage=angular.noop,this.clearImage=angular.noop}e.$inject=["$","_","cornerstone","cornerstoneTools","$rootScope","$q","$parse","wvImage"],t.$inject=["$scope","$element","cornerstone","wvImage"],angular.module("webviewer").directive("wvViewport",e).run(["cornerstoneTools",function(e){var t=e.newImageIdSpecificToolStateManager();t.getStateByToolAndImageId=function(e,t){return this.toolState[t]&&this.toolState[t][e]},t.restoreStateByToolAndImageId=function(e,t,n){this.toolState[t]=this.toolState[t]||{},this.toolState[t][e]=n},e.globalImageIdSpecificToolStateManager=t}])}(),function(){"use strict";function e(){function e(e,t,n,o){var i=this;e.vm.showTopLeftArea=function(){return!!e.vm.wvTags},e.vm.showTopRightArea=function(){return!!e.vm.wvTags&&!!e.vm.wvTags.SeriesDescription&&!!e.vm.wvTags.SeriesNumber},e.vm.showBottomRightArea=function(){return!!e.vm.wvViewport},e.vm.wvShowTimeline="undefined"==typeof e.vm.wvShowTimeline?!0:e.vm.wvShowTimeline,e.vm.wvShowTimeline=e.vm.wvShowTimeline&&!!o.serie,e.vm.wvShowTimeline&&"undefined"==typeof e.vm.wvSerie&&(o.serie.onSerieChanged(this,function(t){e.vm.wvSerie=t}),e.$on("$destroy",function(){o.serie.onSerieChanged.close(i)}))}var n={bindToController:!0,controller:t,controllerAs:"vm",link:e,restrict:"E",transclude:!0,require:{serie:"?^^wvSerieId"},templateUrl:"app/overlay/overlay.directive.tpl.html",scope:{wvTags:"=?",wvSerie:"=?",wvViewport:"=?",wvShowTimeline:"=?"}};return n}function t(){}angular.module("webviewer").directive("wvOverlay",e)}(),function(){"use strict";function e(){function e(e,t,n){function o(){requestAnimationFrame(function(){var t=Math.ceil(100*(e.vm.wvShownImageIndex+1)/e.vm.wvImageCount);e.vm.loadedScrollbarDistanceFromRight=100-t+"%",e.$digest()})}function i(){requestAnimationFrame(function(){var t=Math.ceil(100*(e.vm.wvImageIndex+1)/e.vm.wvImageCount);e.vm.loadingScrollbarDistanceFromRight=100-t+"%",e.$digest()})}e.vm.loadedScrollbarDistanceFromRight="0%",e.vm.loadingScrollbarDistanceFromRight="0%",e.$watchGroup(["vm.wvShownImageIndex","vm.wvImageCount"],o),e.$watchGroup(["vm.wvImageIndex","vm.wvImageCount"],i)}var n={templateUrl:"app/overlay/scrollbar-overlay-item.directive.tpl.html",bindToController:!0,controller:t,controllerAs:"vm",link:e,restrict:"E",scope:{wvImageCount:"=",wvShownImageIndex:"=",wvImageIndex:"="}};return n}function t(){}angular.module("webviewer").directive("wvScrollbarOverlayItem",e)}(),function(){"use strict";function e(e){function t(t,n){var o=n.SlicesShort.map(function(e){for(var t=e[0],n=e[2],o=[],i=0;n>i;++i)o.push(t+":"+i);return o}),i=o.filter(function(e){return 1===e.length}).length===o.length;if(i)var r=[_.flatten(o)];else var r=o;var a=r.map(function(n,o){var i=t.ID+":"+o,r=t.MainDicomTags;return new e(i,n,r)});return a}var n={process:t};return n}e.$inject=["WVSerieModel"],angular.module("webviewer").factory("wvOrthancSerieAdapter",e)}(),function(){"use strict";function e(e){function t(e,t,n){this.id=e,this.imageIds=t,this.imageCount=t.length,this.currentIndex=0,this.currentShownIndex=0,this.tags=n,this.onCurrentImageIdChanged=new osimis.Listener,this.isPlaying=!1,this._playTimeout=null}return t.prototype.setShownImage=function(e){this.currentShownIndex=_.indexOf(this.imageIds,e)},t.prototype.getCurrentImageId=function(){return this.imageIds[this.currentIndex]},t.prototype.goToNextImage=function(e){e!==!0&&(e=!1),this.currentIndex++,this.currentIndex>=this.imageCount&&(this.currentIndex=e?0:this.imageCount-1),this.onCurrentImageIdChanged.trigger(this.getCurrentImageId(),this.setShownImage.bind(this))},t.prototype.goToPreviousImage=function(){this.currentIndex--,this.currentIndex<0&&(this.currentIndex=0),this.onCurrentImageIdChanged.trigger(this.getCurrentImageId(),this.setShownImage.bind(this))},t.prototype.goToImage=function(e){if(0>e)e=0;else if(e+1>this.imageCount)return;this.currentIndex=e,this.onCurrentImageIdChanged.trigger(this.getCurrentImageId(),this.setShownImage.bind(this))},t.prototype.play=function(e){if(!this.isPlaying)if(e)this.playAtSpeed(e);else{var t=25;this.playAtRate(t)}},t.prototype.pause=function(){this._playTimeout&&(e.cancel(this._playTimeout),this._playTimeout=null),this.isPlaying=!1},t.prototype.playAtSpeed=function(t){var n=this;this._playTimeout=e(function(){n.goToNextImage(!0),n.isPlaying&&n.playAtSpeed(t)},t),this.isPlaying=!0},t.prototype.playAtRate=function(e){this.playAtSpeed(50)},t}e.$inject=["$timeout"],angular.module("webviewer").factory("WVSerieModel",e)}(),function(){"use strict";function e(e,t,n,o){function i(e){var t=e.split(":"),n=t[0],o=t[1]||0;return l.listFromOrthancSerieId(n).then(function(e){return e[o]})}function r(i){var r=t.get(n.orthancApiURL+"/series/"+i),a=t.get(n.orthancApiURL+"/series/"+i+"/ordered-slices");return e.all({orthancSerie:r,orthancOrderedInstances:a}).then(function(e){var t=e.orthancSerie.data,n=e.orthancOrderedInstances.data;return o.process(t,n)})}function a(o){return t.get(n.orthancApiURL+"/studies/"+o).then(function(t){var n=t.data,o=n.Series,i=o.map(function(e){return l.listFromOrthancSerieId(e)});return e.all(i)}).then(function(e){return e=_.flatten(e)})}var l={get:i,listFromOrthancSerieId:r,listFromOrthancStudyId:a};return l}e.$inject=["$q","$http","wvConfig","wvOrthancSerieAdapter"],angular.module("webviewer").factory("wvSerie",e)}(),function(){"use strict";function e(){function e(e,t,n){}var n={controller:t,link:e,restrict:"A",scope:!1};return n}function t(e,t,n){var o=[];this.register=function(e){o.push(e)},this.unregister=function(e){_.pull(o,e)};var i=$('<div class="wv-draggable-clone"></div>');t.draggable({helper:function(){return i},start:function(e,n){var i=o[0].getSerie();if(i){var r=n.helper;r.data("serie-id",i.id),r.width(t.width()),r.height(t.height())}},zIndex:100})}t.$inject=["$scope","$element","$attrs"],angular.module("webviewer").directive("wvDraggableSerieExt",e).config(["$provide",function(e){e.decorator("wvSerieIdDirective",["$delegate",function(e){var t=e[0];return t.require.wvDraggableSerieExt="?^wvDraggableSerieExt",e}])}])}(),function(){"use strict";function e(){function e(e,t,n,o){}var n={controller:t,link:e,restrict:"A",scope:!1};return n}function t(e,t){var n=[];this.register=function(e){n.push(e)},this.unregister=function(e){_.pull(n,e)},t.droppable({accept:"[wv-draggable-serie-ext]",drop:function(t,o){var i=$(o.helper),r=i.data("serie-id");e.$apply(function(){n.forEach(function(e){e.setSerie(r)})})}})}t.$inject=["$scope","$element"],angular.module("webviewer").directive("wvDroppableSerieExt",e).config(["$provide",function(e){e.decorator("wvSerieIdDirective",["$delegate",function(e){var t=e[0];return t.require.wvDroppableSerieExt="?^wvDroppableSerieExt",e}])}])}(),function(){"use strict";function e(){function e(e,t,n){}var n={controller:t,link:e,restrict:"A",scope:!1};return n}function t(e,t,n){function o(){e.$apply(function(){r.forEach(function(e){var t=e.getSerie();t&&t.play(40)})})}function i(){e.$apply(function(){r.forEach(function(e){var t=e.getSerie();t&&(t.pause(),t.goToImage(0))})})}var r=[];this.register=function(e){r.push(e)},this.unregister=function(e){_.pull(r,e)},t.on("mouseover",o).on("mouseout",i),e.$on("$destroy",function(){r.forEach(function(e){var t=e.getSerie();t&&t.pause()}),t.off("mouseover",o),t.off("mouseout",i)})}t.$inject=["$scope","$element","$attrs"],angular.module("webviewer").directive("wvScrollOnOverSerieExt",e).config(["$provide",function(e){e.decorator("wvSerieIdDirective",["$delegate",function(e){var t=e[0];return t.require.wvScrollOnOverSerieExt="?^wvScrollOnOverSerieExt",e}])}])}(),function(){"use strict";function e(){function e(e,t,n){}var n={controller:t,link:e,restrict:"A",scope:!1};return n}function t(e,t,n,o){var i=[];this.register=function(e){i.push(e)},this.unregister=function(e){_.pull(i,e)},o(t[0]).wheel(function(t,n,o,r){e.$apply(function(){i.forEach(function(e){var t=e.getSerie();t&&(0>r?t.goToPreviousImage():r>0&&t.goToNextImage(!1))})}),t.preventDefault()}),e.$on("$destroy",function(){o(t[0]).unwheel()})}t.$inject=["$scope","$element","$attrs","hamster"],angular.module("webviewer").directive("wvScrollOnWheelSerieExt",e).config(["$provide",function(e){e.decorator("wvSerieIdDirective",["$delegate",function(e){var t=e[0];return t.require.wvScrollOnWheelSerieExt="?^wvScrollOnWheelSerieExt",e}])}])}(),angular.module("webviewer").directive("wvStatePlay",["$parse",function(e){return{scope:!1,restrict:"A",link:function(t,n,o){function i(e){"undefined"!=typeof e&&(e?r.$broadcast("PlaySerie"):r.$broadcast("PauseSerie"))}var r=t,a=e(o.wvStatePlay);t.$on("SerieHasChanged",function(){i(a(t))}),t.$watch(a,i)}}}]),function(){"use strict";function e(e){function n(t,n,o,i){var r=i.wvSerieId,a=i.wvViewport;r.onCurrentImageIdChanged(function(e,t,n){e?a.setImage(e,!!t).then(function(){n&&n(e)}):a.clearImage()});var l=e(o.wvSerieId);t.$watch(l,function(e){e?r.setSerie(e):r.clearSerie()});var s=e(o.wvSerie);r.onSerieChanged(function(e){s&&s.assign&&s.assign(t,e)}),_.filter(i,function(e,n){var o=_.endsWith(n,"SerieExt");e&&o&&(e.register(r),t.$on("$destroy",function(){e.unregister(r)}))})}var o={require:{wvSerieId:"wvSerieId",wvViewport:"wvViewport"},controller:t,link:n,restrict:"A",scope:!1};return o}function t(e){var t=this;this._serieRepository=e,this._serieId=null,this._serie=null,this.onCurrentImageIdChanged=new osimis.Listener,this.onSerieChanged=new osimis.Listener,this.onSerieChanged(function(e,n){if(n&&n.onCurrentImageIdChanged.close(t),e){e.onCurrentImageIdChanged(t,function(e,n){t.onCurrentImageIdChanged.trigger(e,!1,n)});var o=e.getCurrentImageId();t.onCurrentImageIdChanged.trigger(o,!0)}else t.onCurrentImageIdChanged.trigger(null)})}e.$inject=["$parse"],t.$inject=["wvSerie"],angular.module("webviewer").directive("wvSerieId",e),t.prototype.onSerieChanged=angular.noop,t.prototype.clearSerie=function(){var e=this.serie;this._serieId=null,this._serie=null,this.onSerieChanged.trigger(null,e)},t.prototype.setSerie=function(e){var t=this;this._serieId=e,this._serieRepository.get(e).then(function(e){var n=t._serie;t._serie=e,t.onSerieChanged.trigger(e,n)})},t.prototype.getSerie=function(){return this._serie}}(),angular.module("webviewer").directive("wvSerielist",["wvSerie",function(e){return{scope:{wvStudy:"=",wvClassTmp:"=?wvClass"},templateUrl:"app/serie/wv-serielist.tpl.html",restrict:"E",transclude:!0,link:function(t,n,o){function i(n,o){n&&e.listFromOrthancStudyId(n).then(function(e){t.serieIds=e.map(function(e){return e.id})})}function r(){t.wvClass=t.wvClassTmp||{};var e={ul:t.wvClass.ul||"wv-serielist",li:t.wvClass.li||"wv-serielist-item",overlay:t.wvClass.ul||"wv-serielist-overlay"};t.wvClass=e}r(),t.$watch("wvStudy.id",i),t.serieIds=[]}}}]),angular.module("webviewer").directive("wvSplitpane",["$",function(e){return{scope:{wvLayout:"=?",wvSettings:"=?"},templateUrl:"app/splitpane/wv-splitpane.tpl.html",restrict:"E",transclude:!0,link:function(t,n,o){function i(n,o){n&&(t.x=[n.x],t.y=[n.y],t.rowHeight=100/n.y+"%",t.rowWidth=100/n.x+"%",e(window).resize())}void 0==t.wvLayout&&(t.wvLayout=t.wvSettings&&t.wvSettings.layout||{x:1,y:1}),i(t.wvLayout),t.$watch("wvSettings.layout",i,!0),t.$watch("wvLayout",i,!0)}}}]),angular.module("webviewer").directive("wvToolbarSetting",["_",function(e){return{scope:!0,templateUrl:"app/toolbar/wv-toolbar-setting.tpl.html",restrict:"E",link:function(t,n,o){t.wvName=o.wvName,t.wvIcon=o.wvIcon,t.wvChoices=e.map(t.$eval(o.wvChoices),function(e,t){return{value:e,label:t}})}}}]),angular.module("webviewer").directive("wvToolbarState",function(){return{require:["^^wvToolbar"],scope:!0,templateUrl:"app/toolbar/wv-toolbar-state.tpl.html",restrict:"E",link:function(e,t,n){e.wvName=n.wvName,e.wvIcon=n.wvIcon,e.wvIconOn=n.wvIconOn,e.wvIconOff=n.wvIconOff},controller:function(){}}}),angular.module("webviewer").directive("wvToolbarTool",function(){return{require:["^^wvToolbar"],scope:!0,templateUrl:"app/toolbar/wv-toolbar-tool.tpl.html",restrict:"E",link:function(e,t,n){e.wvName=n.wvName,e.wvIcon=n.wvIcon},controller:function(){}}}),angular.module("webviewer").directive("wvToolbar",["_",function(e){return{scope:{wvItems:"=",activeTool:"=?wvActiveTool"},templateUrl:"app/toolbar/wv-toolbar.tpl.html",transclude:!0,restrict:"E",link:function(e,t,n){},controller:["$timeout","$scope",function(t,n){n.activeTool=n.activeTool||"windowing",n.activeStates={},n.splitpaneConfig={x:1,y:1},n.$watch("activeTool",function(e,o){n.wvItems.hasOwnProperty(o)&&(n.wvItems[o]=!1),t(function(){n.wvItems[e]=!0})}),n.$watchCollection("activeStates",function(t){e.forEach(t,function(e,t){n.wvItems.hasOwnProperty(t)&&(n.wvItems[t]=e)})}),n.activeButton=null,void 0!=n.wvItems&&e.size(n.wvItems)||(n.wvItems={windowing:!0,zoom:!1,pan:!1,invert:!1,lengthmeasure:!1,anglemeasure:!1,pixelprobe:!1,ellipticalroi:!1,rectangleroi:!1,layout:{x:1,y:1},play:!1,overlay:!0}),this.set=function(e){var o=n.activeButton,i=e;o!=i&&(null!==o&&n.$broadcast("toolbar.deactivated",o),n.activeButton=i,null!==i&&t(function(){n.$broadcast("toolbar.activated",i)}))},this.get=function(){return n.activeButton}}]}}]),function(e){"use strict";function t(){function e(e,n){var o=n||e,i=n&&e;i&&(o.namespace=i),t.push(o)}var t=[],n=0;return e.once=function(t){var o=n++;e(".<_^_>. ]MONDOSHAWANS"+o+"[ .<_^_>.",function(){t.apply(this,arguments),e.close(".<_^_>. ]MONDOSHAWANS"+o+"[ .<_^_>.")})},e.close=function(e){e?_.remove(t,function(t){return t.namespace&&t.namespace===e}):t=[]},e.ignore=function(e,n){t.forEach(function(t){t.namespace===e&&(t.ignore=!0)}),n(),t.forEach(function(t){t.namespace===e&&(t.ignore=!1)})},e.trigger=function(){var e=Array.prototype.splice.call(arguments,0);t.filter(function(e){return!e.ignore}).forEach(function(t){t.apply(null,e)})},e}e.Listener=t}(window.osimis||(window.osimis={})),function(){"use strict";function e(){function e(e,t,n,o){}var n={controller:t,link:e,restrict:"A",scope:!1,require:"wvSize"};return n}function t(e,t,n,o,i,r){function a(t){return e.isString(t)&&t.match(/^[0-9]+\w+$/)}function l(t){return e.isNumber(t)}function s(t){return e.isString(t)&&"[wv-size-tag]"===t}function c(t){return e.isString(t)&&t.match(/^[0-9]+(px)?$/)}var u=t(o.wvSize),v=this,w=[];n.$watch(u,function(e,t){var n=e.width,o=e.height;"undefined"!=typeof n&&"undefined"!=typeof o&&v.updateSize(n,o)},!0);var d=r(function(){n.$apply(function(){var e=u(n);(s(e.width)||s(e.height))&&v.updateSize(e.width,e.height)})},10);$(window).on("resize",d),n.$on("$destroy",function(){$(window).off("resize",d)}),this.onUpdate=function(t){return w.push(t),function(){e.pull(w,t)}},this.updateSize=function(e,t){var o=null,r=u.assign;if(r&&r(n,{width:e,height:t}),s(e)&&(o=o||i.closest("[wv-size-tag]"),e=o.width()+"px"),s(t)&&(o=o||i.closest("[wv-size-tag]"),t=o.height()+"px"),a(e)&&a(t))this.setSpecificWidthAndSpecificHeight(e,t);else if(a(e)&&l(t))this.setSpecificWidthAndScaleHeight(e,t);else{if(!a(t)||!l(e))throw new Error("wv-size: unsupported options");this.setSpecificHeightAndScaleWidth(t,e)}},this.setWidth=function(e){var t=u(n).height;this.updateSize(e,t)},this.setHeight=function(e){var t=u(n).width;this.updateSize(t,e)},this.getWidthInPixel=function(){var e=u(n).width;return c(e)?+e.replace("px",""):+i.width()},this.getHeightInPixel=function(){var e=u(n).height;return c(e)?+e.replace("px",""):+i.height()},this.setSpecificWidthAndSpecificHeight=function(e,t){i.css("width",e),i.css("height",t),w.forEach(function(e){e()})},this.setSpecificWidthAndScaleHeight=function(e,t){var n=e.replace(/^([0-9]+)(\w+)$/,function(e,n,o){return n*t+o});i.css("width",e),i.css("height",n),w.forEach(function(e){e()})},this.setSpecificHeightAndScaleWidth=function(e,t){var n=e.replace(/^([0-9]+)(\w+)$/,function(e,n,o){return n*t+o});i.css("height",e),i.css("width",n),w.forEach(function(e){e()})}}t.$inject=["_","$parse","$scope","$attrs","$element","debounce"],angular.module("webviewer").directive("wvSize",e)}(),angular.module("webviewer").directive("wvStudylist",["$http","wvConfig",function(e,t){return{scope:{wvSelectedStudy:"="},template:['<button type="button" class="btn btn-default wv-studylist" ','ng-model="wvSelectedStudy" placeholder="Study.." ','bs-options="study.value as study.label for study in studies"'," bs-select>","</button>"].join(""),restrict:"E",link:function(n,o,i){n.studies=[],e.get(t.orthancApiURL+"/studies/").then(function(o){var i=o.data;n.studies=i.map(function(e){return{label:"?",value:{id:e}}}),n.studies.forEach(function(n){e.get(t.orthancApiURL+"/studies/"+n.value.id).then(function(e){var t=e.data;n.label=t.MainDicomTags.StudyDescription})})})}}}]),angular.module("webviewer").run(["$templateCache",function(e){e.put("app/image/viewport.directive.tpl.html",'<div class="cornerstone-enabled-image wv-cornerstone-enabled-image" oncontextmenu="return false" unselectable=on onselectstart="return false;" onmousedown="return false;" style="position: relative;"><ng-transclude><wv-overlay wv-tags=vm.wvTags wv-viewport=vm.wvViewport ng-if=vm.wvEnableOverlay></wv-overlay></ng-transclude></div>'),e.put("app/overlay/overlay.directive.tpl.html","<div class=wv-overlay ng-transclude><div class=wv-overlay-topleft ng-if=vm.showTopLeftArea()>{{vm.wvTags.PatientName}}<br>{{vm.wvTags.PatientID}}</div><div class=wv-overlay-topright ng-if=vm.showTopRightArea()>{{vm.wvTags.StudyDescription}}<br>{{vm.wvTags.StudyDate}}<br>#{{vm.wvTags.SeriesNumber}} - {{vm.wvTags.SeriesDescription}}<br></div><div class=wv-overlay-bottomright ng-if=vm.showBottomRightArea()>zoom: {{vm.wvViewport.scale|number:2}}<br>ww/wc: {{vm.wvViewport.voi.windowWidth|number:0}}/{{vm.wvViewport.voi.windowCenter|number:0}}</div><wv-scrollbar-overlay-item wv-image-count=vm.wvSerie.imageCount wv-image-index=vm.wvSerie.currentIndex wv-shown-image-index=vm.wvSerie.currentShownIndex ng-if=vm.wvShowTimeline></wv-scrollbar-overlay-item></div>"),e.put("app/overlay/scrollbar-overlay-item.directive.tpl.html",'<div><div class=wv-overlay-scrollbar-text>{{vm.wvShownImageIndex + 1}}/{{vm.wvImageCount}}<br></div><div class=wv-overlay-scrollbar-loading ng-style="{ right: vm.loadingScrollbarDistanceFromRight }"></div><div class=wv-overlay-scrollbar-loaded ng-style="{ right: vm.loadedScrollbarDistanceFromRight }"></div></div>'),e.put("app/serie/wv-serielist.tpl.html","<ul class={{wvClass.ul}}><li ng-repeat=\"id in serieIds\" class={{wvClass.li}} ng-transclude wv-size-tag><wv-viewport wv-serie-id=id wv-tags=$tags wv-size=\"{width: '[wv-size-tag]', height: '[wv-size-tag]'}\" wv-draggable-serie-ext wv-scroll-on-over-serie-ext><wv-overlay wv-tags=$tags><div class=wv-serielist-overlay>{{$tags.SeriesDescription}}</div></wv-overlay></wv-viewport></li></ul>"),
e.put("app/splitpane/wv-splitpane.tpl.html",'<div class=wv-splitpane><div ng-repeat="$y in y | range track by $index" class=wv-splitpane-row ng-style="{height: rowHeight}"><div ng-repeat="$x in x | range track by $index" class=wv-splitpane-cell ng-style="{width: rowWidth}" wv-size-tag ng-transclude><wv-viewport wv-serie-id=randomSerieId wv-size="{width: \'[wv-size-tag]\', height:\'[wv-size-tag]\'}" wv-droppable-serie-ext wv-scroll-on-wheel-serie-ext wv-enable-overlay="!wvSettings || wvSettings.hasOwnProperty(\'overlay\') == false || wvSettings.overlay" wv-angle-measure-viewport-tool=wvSettings.anglemeasure wv-viewport-mouse-events wv-tool-zoom=wvSettings.zoom wv-tool-pan=wvSettings.pan wv-tool-lengthmeasure=wvSettings.lengthmeasure wv-tool-pixelprobe=wvSettings.pixelprobe wv-tool-ellipticalroi=wvSettings.ellipticalroi wv-tool-rectangleroi=wvSettings.rectangleroi wv-state-invert=wvSettings.invert wv-state-play=wvSettings.play></wv-viewport></div></div></div>'),e.put("app/toolbar/wv-toolbar-setting.tpl.html",'<button type=button class="btn btn-sm btn-default wv-toolbar-item" html=1 placeholder="<span class=&quot;fa fa-th-large&quot;></span>" icon-checkmark="fa fa-th-large" bs-options="item.value as item.label for item in wvChoices" ng-model=wvItems[wvName] bs-select ng-if=wvItems.hasOwnProperty(wvName)></button>'),e.put("app/toolbar/wv-toolbar-state.tpl.html",'<label class="btn btn-sm btn-default wv-toolbar-item" ng-class="wvIcon || ($parent.$parent.activeStates[wvName] ? wvIconOn : wvIconOff)" ng-if=wvItems.hasOwnProperty(wvName)><input type=checkbox value={{wvName}} style="display: none;" ng-model=$parent.$parent.activeStates[wvName] bs-checkbox></label>'),e.put("app/toolbar/wv-toolbar-tool.tpl.html",'<label class="btn btn-sm btn-default wv-toolbar-item" ng-if=wvItems.hasOwnProperty(wvName)><span ng-class=wvIcon></span> <input type=radio value={{wvName}} style="display: none;" ng-model=$parent.$parent.activeTool bs-radio></label>'),e.put("app/toolbar/wv-toolbar.tpl.html",'<div class="wv-toolbar btn-toolbar" role=toolbar style="margin-left: 0;" ng-transclude ng-init="wvItems = wvItems || $parent.wvItems"><div class=wv-toolbar-settings><wv-toolbar-setting wv-name=layout wv-icon="fa fa-th-large" wv-choices="{ \'1x1\': {x: 1, y: 1}, \'2x1\': {x: 2, y: 1}, \'1x2\': {x: 1, y: 2}, \'2x2\': {x: 2, y: 2} }"></wv-toolbar-setting></div><div class=wv-toolbar-states><wv-toolbar-state wv-name=invert wv-icon="fa fa-adjust"></wv-toolbar-state><wv-toolbar-state wv-name=play wv-icon-on="fa fa-pause" wv-icon-off="fa fa-play"></wv-toolbar-state></div><div class=wv-toolbar-tools><wv-toolbar-tool wv-name=windowing wv-icon="fa fa-sun-o"></wv-toolbar-tool><wv-toolbar-tool wv-name=zoom wv-icon="fa fa-search"></wv-toolbar-tool><wv-toolbar-tool wv-name=pan wv-icon="fa fa-arrows"></wv-toolbar-tool><wv-toolbar-tool wv-name=lengthmeasure wv-icon="fa fa-arrows-v"></wv-toolbar-tool><wv-toolbar-tool wv-name=anglemeasure wv-icon="fa fa-angle-left"></wv-toolbar-tool><wv-toolbar-tool wv-name=pixelprobe wv-icon="fa fa-dot-circle-o"></wv-toolbar-tool><wv-toolbar-tool wv-name=ellipticalroi wv-icon="fa fa-circle-o"></wv-toolbar-tool><wv-toolbar-tool wv-name=rectangleroi wv-icon="fa fa-square-o"></wv-toolbar-tool></div><div class=wv-toolbar-end></div></div>')}]);