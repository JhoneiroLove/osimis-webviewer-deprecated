/**
 * webViewer - webViewer Project Generated from OsimisAngular
 * @authors 
 * @version v0.0.1
 * @link 
 * @license 
 */
!function(){"use strict";var e="0.2.9";angular.module("webviewer",["ngResource","ngSanitize","mgcrea.ngStrap","ngRangeFilter","debounce"]).constant("$",window.$).constant("_",window._).constant("pako",window.pako).constant("JpegImage",window.JpegImage).constant("hamster",window.Hamster).constant("cornerstone",window.cornerstone).constant("cornerstoneTools",window.cornerstoneTools).provider("wvConfig",function(){var t={version:e,orthancApiURL:"",webviewerApiURL:"web-viewer",defaultCompression:"jpeg95"};this.setApiURL=function(e){"/"===e.substr(-1)&&(e=e.substr(0,e.length-1)),t.orthancApiURL=e,t.webviewerApiURL=e+"/web-viewer"},this.$get=function(){return t}}).config(["$httpProvider",function(e){e.defaults.cache=!0,console.error("warning: cache is activated in the whole application")}])}(),function(){"use strict";function e(){function e(e){e=_.flatten(e),this._annotations=e||[]}return e.prototype.toArray=function(){return this._annotations},e.prototype.filterByType=function(t){var n=this._annotations.filter(function(e){return e.type===t});return new e(n)},e.prototype.filterByImageId=function(t){var n=this._annotations.filter(function(e){return e.imageId===t});return new e(n)},e.prototype.getImageIds=function(){return this._annotations.reduce(function(e,t){var n=t.imageId;return-1===e.indexOf(n)&&e.push(n),e},[])},e.prototype.getTypes=function(){return this._annotations.reduce(function(e,t){var n=t.type;return-1===e.indexOf(n)&&e.push(n),e},[])},e.prototype.mapByImageIds=function(t){var n=this._annotations.reduce(function(e,t){var n=t.imageId;return e.hasOwnProperty(n)||(e[n]=[]),e[n].push(t),e},{}),o=_(n).mapValues(function(t){return new e(t)}).value();return _(o).map(t).value()},e.prototype.hasType=function(e){return this._annotations.reduce(function(t,n){return t||n.type===e},!1)},e}angular.module("webviewer").factory("WvAnnotationGroup",e)}(),function(){"use strict";function e(e){function t(e){e=_.cloneDeep(e),o[e.type]=o[e.type]||{},o[e.type][e.imageId]=e,(!e.data||"undefined"!=typeof e.data.length&&0===e.data.length)&&delete o[e.type][e.imageId],i.onAnnotationChanged.trigger(e)}function n(e,t){return t?o[t]&&o[t][e]:_(o).flatMap(function(e){return _.values(e)}).filter(function(t){return t.imageId===e}).cloneDeep()}var o={},i={set:t,getByImageId:n,onAnnotationChanged:new osimis.Listener};return i}e.$inject=["WvAnnotationValueObject"],angular.module("webviewer").factory("wvAnnotationManager",e)}(),function(){"use strict";function e(){function e(e,t,n){this.type=e,this.imageId=t,this.data=n}return e}angular.module("webviewer").factory("WvAnnotationValueObject",e)}(),function(){"use strict";function e(e,t,o){function i(e,t){var i=t;i.imageId=e,i.color?i.render=o.renderColorImage:i.render=o.renderGrayscaleImage;var r=n(i);return i.getPixelData=function(){return r},i}var r={process:i};return r}function t(e,t,n,o,i){for(var r=(i-n)/(o-t),a=n-r*t,l=0,s=e.length;s>l;l++)e[l]=r*e[l]+a}function n(e){switch(e.Orthanc.Compression){case"Deflate":return i(e);case"Jpeg":return r(e);default:throw new Error("unknown compression")}}function o(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),o=0,i=e.length;i>o;o++)n[o]=e.charCodeAt(o);return n}function i(e){var t,n,o,i=pako.inflate(window.atob(e.Orthanc.PixelData)),r=null;if(e.color)for(t=new ArrayBuffer(i.length/3*4),r=new Uint8Array(t),n=0,o=0;o<i.length;o+=3)r[n++]=i[o],r[n++]=i[o+1],r[n++]=i[o+2],r[n++]=255;else for(t=new ArrayBuffer(2*i.length),r=e.Orthanc.IsSigned?new Int16Array(t):new Uint16Array(t),n=0,o=0;o<i.length;o+=2){var a=i[o],l=i[o+1];r[n]=a+256*l,n++}return r}function r(e){var n=new JpegImage,i=o(window.atob(e.Orthanc.PixelData));n.parse(i);var r,a,l,s=n.getData(e.width,e.height),c=null;if(e.color)for(r=new ArrayBuffer(s.length/3*4),c=new Uint8ClampedArray(r),a=0,l=0;l<s.length;l+=3)c[a++]=s[l],c[a++]=s[l+1],c[a++]=s[l+2],c[a++]=255;else{for(r=new ArrayBuffer(2*s.length),c=e.Orthanc.IsSigned?new Int16Array(r):new Uint16Array(r),a=0,l=0;l<s.length;l++)c[a]=s[l],a++;e.Orthanc.Stretched&&t(c,0,e.Orthanc.StretchLow,255,e.Orthanc.StretchHigh)}return c}e.$inject=["$http","wvConfig","cornerstone"],angular.module("webviewer").factory("wvCornerstoneImageAdapter",e)}(),function(){"use strict";function e(e,t,n,o,i,r,a,l){function s(t){var n=this;if(!g.hasOwnProperty(t)){var o=t.split("|");t=o[0];var i=o.splice(1),l=i.map(function(e){o=e.split("~");var t=o[0],n=o.splice(1);if(!w.hasOwnProperty(t))throw new Error("wv-image: unknown post processor");var i=new(Function.prototype.bind.apply(w[t],[null].concat(n)));return i});o=t.split(":");var s=o[0];o[1]||0;g[t]=e.get(r.orthancApiURL+"/instances/"+s+"/simplified-tags").then(function(e){var o=e.data;return new a(n,t,o,l)})}return g[t]}function c(t){if(!d.hasOwnProperty(t)){var n=r.defaultCompression,o=t.split(":"),i=o[0],a=o[1];d[t]=e.get(r.webviewerApiURL+"/instances/"+n+"-"+i+"_"+a).then(function(e){return l.process(t,e.data)})}return d[t]}function u(e,t){w[e]=t}function v(e,r,a){function l(){u.css("overflow",v),$("#FAKE-VIEWPORT-USED-IN-IMAGE-SERVICE").remove(),s.$destroy()}var s=i.$new();s.size={width:r+"px",height:a+"px"},s.imageId=e;var c=n(['<wv-viewport id="FAKE-VIEWPORT-USED-IN-IMAGE-SERVICE"','wv-image-id="imageId"','wv-size="size"','wv-enable-overlay="false"','wv-angle-measure-viewport-tool="true"','wv-length-measure-viewport-tool="true"','wv-elliptical-roi-viewport-tool="true"','wv-zoom-viewport-tool="true"','wv-pan-viewport-tool="true"','wv-pixel-probe-viewport-tool="true"','wv-rectangle-roi-viewport-tool="true"',">","</wv-viewport>"].join("\n"))(s),u=$("body"),v=u.css("overflow");return u.css("overflow","hidden"),c.css("position","absolute"),c.css("left","-50000px"),u.append(c),t(function(e,t){o(function(){var t=null,n=c.find("canvas").get(0);t=n.toDataURL(),l(),e(t)})})}var p={get:s,getPixelObject:c,createAnnotedImage:v,registerPostProcessor:u},w={},g={},d={};return p}e.$inject=["$http","$q","$compile","$timeout","$rootScope","wvConfig","WvImage","wvCornerstoneImageAdapter"],angular.module("webviewer").factory("wvImageManager",e)}(),function(){"use strict";function e(e,t){function n(t,n,o,i){var r=this;this.id=n,this.tags=o,this.postProcesses=i||[],this.onAnnotationChanged=new osimis.Listener,e.onAnnotationChanged(function(e){e.imageId===r.id&&r.onAnnotationChanged.trigger(e)});var a=null;this.getPixelObject=function(){if(null===a){a=t.getPixelObject(this.id);var e=t.getPixelObject.bind(t);this.postProcesses.forEach(function(t){a=a.then(function(n){return t.execute(n,e)})})}return a}}return n.prototype.getAnnotations=function(t){return e.getByImageId(this.id,t)},n.prototype.setAnnotations=function(n,o){var i=new t(n,this.id,o);e.set(i)},n}e.$inject=["wvAnnotationManager","WvAnnotationValueObject"],angular.module("webviewer").factory("WvImage",e)}(),function(){"use strict";function e(){function e(){}return e}angular.module("webviewer").factory("WvMask",e)}(),function(){"use strict";function e(e,t){function n(){this.masksImageIds=Array.prototype.slice.call(arguments)}function o(e){if(!e.color){var t=e.getPixelData();e.getPixelData=function(){for(var e=new ArrayBuffer(4*t.length),n=new Uint8ClampedArray(e),o=0,i=0;i<t.length;++i)n[o++]=t[i],n[o++]=t[i],n[o++]=t[i],n[o++]=255;return n},e.color=!0,e.render=cornerstone.renderColorImage}}function i(t,n){var o=e.cloneDeep(t),i=o.getPixelData(),r=n.getPixelData();return o.getPixelData=function(){for(var e=0;e<i.length;e+=4)r[e+0]>0&&(i[e+0]=i[e+0]/2+r[e+0]/2);return i},o}return n.prototype.execute=function(e,n){o(e);var r=this.masksImageIds.map(function(e){return n(e)});return t.all(r).then(function(t){return t.reduce(function(e,t){return o(t),i(e,t)},e)})},n}e.$inject=["_","$q"],angular.module("webviewer").factory("WvColorMaskPostProcessor",e).run(["wvImageManager","WvColorMaskPostProcessor",function(e,t){e.registerPostProcessor("colormask",t)}])}(),function(){"use strict";function e(){function e(e,t,n,o){var i=this;o.serie&&o.droppableSerieExt?(e.show=!o.serie.hasSerie(),o.serie.onSerieChanged(i,function(t){e.show=!o.serie.hasSerie()}),e.$on("$destroy",function(){o.serie.onSerieChanged.close(i)})):e.show=!1}var n={bindToController:!0,controller:t,controllerAs:"vm",link:e,restrict:"E",transclude:!0,require:{serie:"?^^wvSerieId",droppableSerieExt:"?^^wvDroppableSerieExt"},templateUrl:"app/overlay/droppable-serie-overlay-item.directive.html",scope:{}};return n}function t(){}angular.module("webviewer").directive("wvDroppableSerieOverlayItem",e)}(),function(){"use strict";function e(){function e(e,t,n,o){var i=this;e.vm.showTopLeftArea=function(){return!!e.vm.wvTags},e.vm.showTopRightArea=function(){return!!e.vm.wvTags&&!!e.vm.wvTags.SeriesDescription&&!!e.vm.wvTags.SeriesNumber},e.vm.showBottomRightArea=function(){return!!e.vm.wvViewport&&!!e.vm.wvTags},e.vm.wvShowTimeline="undefined"==typeof e.vm.wvShowTimeline?!0:e.vm.wvShowTimeline,e.vm.showTimeline=!1,e.vm.wvShowTimeline&&"undefined"==typeof e.vm.wvSerie&&(o.serie.onSerieChanged(i,function(t){e.vm.wvSerie=t,e.vm.showTimeline=e.vm.wvShowTimeline&&!!t.imageCount}),e.$on("$destroy",function(){o.serie.onSerieChanged.close(i)}))}var n={bindToController:!0,controller:t,controllerAs:"vm",link:e,restrict:"E",transclude:!0,require:{serie:"?^^wvSerieId"},templateUrl:"app/overlay/overlay.directive.html",scope:{wvTags:"=?",wvSerie:"=?",wvViewport:"=?",wvShowTimeline:"=?"}};return n}function t(){}angular.module("webviewer").directive("wvOverlay",e)}(),function(){"use strict";function e(){function e(e,t,n){function o(){var t=Math.ceil(100*(e.vm.wvShownImageIndex+1)/e.vm.wvImageCount);e.vm.loadedScrollbarDistanceFromRight=100-t+"%"}function i(){var t=Math.ceil(100*(e.vm.wvImageIndex+1)/e.vm.wvImageCount);e.vm.loadingScrollbarDistanceFromRight=100-t+"%"}e.vm.loadedScrollbarDistanceFromRight="0%",e.vm.loadingScrollbarDistanceFromRight="0%",e.$watchGroup(["vm.wvShownImageIndex","vm.wvImageCount"],o),e.$watchGroup(["vm.wvImageIndex","vm.wvImageCount"],i)}var n={templateUrl:"app/overlay/scrollbar-overlay-item.directive.html",bindToController:!0,controller:t,controllerAs:"vm",link:e,restrict:"E",scope:{wvImageCount:"=",wvShownImageIndex:"=",wvImageIndex:"="}};return n}function t(){}angular.module("webviewer").directive("wvScrollbarOverlayItem",e)}(),function(){"use strict";function e(e){function t(t,n,o){var i=n.SlicesShort.map(function(e){for(var t=e[0],n=e[2],o=[],i=0;n>i;++i)o.push(t+":"+i);return o}),r=i.filter(function(e){return 1===e.length}).length===i.length;if(r)var a=[_.flatten(i)];else var a=i;var l=a.map(function(n,i){var r=t.ID+":"+i;return o=o||t.MainDicomTags,new e(r,n,o)});return l}var n={process:t};return n}e.$inject=["WvSerie"],angular.module("webviewer").factory("wvOrthancSerieAdapter",e)}(),function(){"use strict";function e(e,t,n,o){function i(e){var t=e.split(":"),n=t[0],o=t[1]||0;return l.listFromOrthancSerieId(n).then(function(e){return e[o]})}function r(i){var r=t.get(n.orthancApiURL+"/series/"+i),a=t.get(n.orthancApiURL+"/series/"+i+"/ordered-slices");return a.then(function(o){var i=o.data.SlicesShort[0][0],a=t.get(n.orthancApiURL+"/instances/"+i+"/simplified-tags");return e.all({orthancSerie:r,orthancOrderedInstances:o,tags:a})}).then(function(e){var t=e.orthancSerie.data,n=e.orthancOrderedInstances.data,i=e.tags.data;return o.process(t,n,i)})}function a(o){return t.get(n.orthancApiURL+"/studies/"+o).then(function(t){var n=t.data,o=n.Series,i=o.map(function(e){return l.listFromOrthancSerieId(e)});return e.all(i)}).then(function(e){return e=_.flatten(e)})}var l={get:i,listFromOrthancSerieId:r,listFromOrthancStudyId:a};return l}e.$inject=["$q","$http","wvConfig","wvOrthancSerieAdapter"],angular.module("webviewer").factory("wvSerieManager",e)}(),function(){"use strict";function e(e,t,n,o){function i(e,t,o){var i=this;this.id=e,this.imageIds=t,this.imageCount=t.length,this.currentIndex=0,this.currentShownIndex=0,this.tags=o,this.onCurrentImageIdChanged=new osimis.Listener,this.onAnnotationChanged=new osimis.Listener,this._annotationGroup=null,n.onAnnotationChanged(function(e){-1!==i.imageIds.indexOf(e.imageId)&&(i._annotationGroup=null,i.onAnnotationChanged.trigger(e))}),this.isPlaying=!1,this._playTimeout=null}i.prototype._loadAnnotationGroup=function(){if(!this._annotationGroup){var e=[];this.imageIds.forEach(function(t){e.push(n.getByImageId(t))}),this._annotationGroup=new o(e)}return this._annotationGroup},i.prototype.getAnnotedImageIds=function(e){return this._loadAnnotationGroup().filterByType(e).getImageIds()},i.prototype.getAnnotationGroup=function(e){return this._loadAnnotationGroup()},i.prototype.getAnnotations=function(e){var t=this._loadAnnotationGroup();return e&&t.filterByType(e),t.toArray()},i.prototype.getIndexOf=function(e){return this.imageIds.indexOf(e)},i.prototype.setShownImage=function(e){this.currentShownIndex=this.getIndexOf(e)},i.prototype.getCurrentImageId=function(){return this.imageIds[this.currentIndex]},i.prototype.goToNextImage=function(e){e!==!0&&(e=!1),this.currentIndex++,this.currentIndex>=this.imageCount&&(this.currentIndex=e?0:this.imageCount-1),this.onCurrentImageIdChanged.trigger(this.getCurrentImageId(),this.setShownImage.bind(this))},i.prototype.goToPreviousImage=function(){this.currentIndex--,this.currentIndex<0&&(this.currentIndex=0),this.onCurrentImageIdChanged.trigger(this.getCurrentImageId(),this.setShownImage.bind(this))},i.prototype.goToImage=function(e){if(0>e)e=0;else if(e+1>this.imageCount)return;this.currentIndex=e,this.onCurrentImageIdChanged.trigger(this.getCurrentImageId(),this.setShownImage.bind(this))};var r=null;return i.prototype.play=function(){var t=this,n=1e3/this.tags.RecommendedDisplayFrameRate||1e3/30;if(!this.isPlaying){var o=null,i=0;!function a(){r=requestAnimationFrame(function(r){if(i)--i;else{var l=1e3/(r-o);i=Math.round(l/n),e.$apply(function(){t.goToNextImage(!0)})}o=r,t.isPlaying&&a()})}(),this.isPlaying=!0}},i.prototype.pause=function(){r&&(cancelAnimationFrame(r),r=null),this.isPlaying=!1},i}e.$inject=["$rootScope","$timeout","wvAnnotationManager","WvAnnotationGroup"],angular.module("webviewer").factory("WvSerie",e)}(),angular.module("webviewer").directive("wvSerielist",["wvSerieManager",function(e){return{scope:{wvStudy:"=",wvClassTmp:"=?wvClass"},templateUrl:"app/serielist/serielist.directive.html",restrict:"E",transclude:!0,link:function(t,n,o){function i(n,o){n&&e.listFromOrthancStudyId(n).then(function(e){t.serieIds=e.map(function(e){return e.id})})}function r(){t.wvClass=t.wvClassTmp||{};var e={ul:t.wvClass.ul||"wv-serielist",li:t.wvClass.li||"wv-serielist-item",overlay:t.wvClass.ul||"wv-serielist-overlay"};t.wvClass=e}t.$watchCollection("wvClassTmp",function(){r()}),t.$watch("wvStudy.id",i),t.serieIds=[]}}}]),angular.module("webviewer").directive("wvSplitpane",["$","$timeout",function(e,t){return{scope:{wvLayout:"=?",wvSettings:"=?"},templateUrl:"app/splitpane/splitpane.directive.html",restrict:"E",transclude:!0,link:function(n,o,i,r,a){function l(o,i){o&&(n.x=[o.x],n.y=[o.y],n.rowHeight=100/o.y+"%",n.rowWidth=100/o.x+"%",t(function(){e(window).resize()}))}n.showDefaultContent=!1,a(function(e){_.filter(e,function(e){return e instanceof HTMLElement||_.trim(e.textContent).length}).length||(n.showDefaultContent=!0)}),n.wvLayout=n.wvLayout||n.wvSettings&&n.wvSettings.layout||{x:1,y:1},n.$watch("wvLayout",l,!0)}}}]),angular.module("webviewer").directive("wvToolbarAction",["$parse",function(e){return{require:["^^wvToolbar"],scope:!0,templateUrl:"app/toolbar/wv-toolbar-action.tpl.html",restrict:"E",link:function(t,n,o){t.wvName=o.wvName,t.wvIcon=o.wvIcon,t.wvAction=e(o.wvAction).bind(e,t)},controller:function(){}}}]),angular.module("webviewer").directive("wvToolbarSetting",["_",function(e){return{scope:!0,templateUrl:"app/toolbar/wv-toolbar-setting.tpl.html",restrict:"E",link:function(t,n,o){t.wvName=o.wvName,t.wvIcon=o.wvIcon,t.wvChoices=e.map(t.$eval(o.wvChoices),function(e,t){return{value:e,label:t}})}}}]),angular.module("webviewer").directive("wvToolbarState",function(){return{require:["^^wvToolbar"],scope:!0,templateUrl:"app/toolbar/wv-toolbar-state.tpl.html",restrict:"E",link:function(e,t,n){e.wvName=n.wvName,e.wvIcon=n.wvIcon,e.wvIconOn=n.wvIconOn,e.wvIconOff=n.wvIconOff},controller:function(){}}}),angular.module("webviewer").directive("wvToolbarTool",function(){return{require:["^^wvToolbar"],scope:!0,templateUrl:"app/toolbar/wv-toolbar-tool.tpl.html",restrict:"E",link:function(e,t,n){e.wvName=n.wvName,e.wvIcon=n.wvIcon},controller:function(){}}}),angular.module("webviewer").directive("wvToolbar",["_",function(e){return{scope:{wvItems:"=",activeTool:"=?wvActiveTool"},templateUrl:"app/toolbar/wv-toolbar.tpl.html",transclude:!0,restrict:"E",link:function(e,t,n){},controller:["$timeout","$scope",function(t,n){n.activeTool=n.activeTool||"windowing",n.activeStates={},n.splitpaneConfig={x:1,y:1},n.$watch("activeTool",function(e,o){n.wvItems.hasOwnProperty(o)&&(n.wvItems[o]=!1),t(function(){n.wvItems[e]=!0})}),n.$watchCollection("activeStates",function(t){e.forEach(t,function(e,t){n.wvItems.hasOwnProperty(t)&&(n.wvItems[t]=e)})}),n.activeButton=null,void 0!=n.wvItems&&e.size(n.wvItems)||(n.wvItems={windowing:!0,zoom:!1,pan:!1,invert:!1,lengthmeasure:!1,anglemeasure:!1,pixelprobe:!1,ellipticalroi:!1,rectangleroi:!1,layout:{x:1,y:1},play:!1,overlay:!0,vflip:!1,hflip:!1,rotateleft:!1,rotateright:!1}),this.set=function(e){var o=n.activeButton,i=e;o!=i&&(null!==o&&n.$broadcast("toolbar.deactivated",o),n.activeButton=i,null!==i&&t(function(){n.$broadcast("toolbar.activated",i)}))},this.get=function(){return n.activeButton}}]}}]),function(e){"use strict";function t(){function e(e,n){var o=n||e,i=n&&e;i&&(o.namespace=i),t.push(o)}var t=[],o=0;return e.once=function(t){var n=o++;e(".<_^_>. ]MONDOSHAWANS"+n+"[ .<_^_>.",function(){t.apply(this,arguments),e.close(".<_^_>. ]MONDOSHAWANS"+n+"[ .<_^_>.")})},e.close=function(e){e?_.remove(t,function(t){return t.namespace&&n(t.namespace,e)}):t=[]},e.ignore=function(e,o){t.forEach(function(t){n(t.namespace,e)&&(t.ignore=!0)}),o(),t.forEach(function(t){n(t.namespace,e)&&(t.ignore=!1)})},e.trigger=function(){var e=Array.prototype.splice.call(arguments,0);t.filter(function(e){return!e.ignore}).forEach(function(t){t.apply(null,e)})},e}function n(e,t){return _.isArray(e)&&_.isArray(t)?_.isEqualWith(e,t,function(e,t){return e.length===t.length&&e.reduce(function(e,n,o){return e&&n===t[o]},!0)}):e===t}e.Listener=t}(window.osimis||(window.osimis={})),function(){"use strict";function e(e,n,o){function r(e,t,r,a){if(t.parent().length){var l=n(r.wvSize);e.$watch(l,function(e,t){var n=e.width,o=e.height;"undefined"!=typeof n&&"undefined"!=typeof o&&a.updateSize(n,o)},!0);var s=o(function(){e.$apply(function(){var t=l(e);(i(t.width)||i(t.height))&&a.updateSize(t.width,t.height)})},10);$(window).on("resize",s),e.$on("$destroy",function(){$(window).off("resize",s)})}}var a={controller:t,link:{pre:r},restrict:"A",scope:!1,require:"wvSize",priority:100};return a}function t(e,t,a,l,s){var c=t(l.wvSize),u=[];this.onUpdate=function(t){return u.push(t),function(){e.pull(u,t)}},this.updateSize=function(e,t){var r=null,l=c.assign;if(l&&l(a,{width:e,height:t}),i(e)){if(r=r||s.closest("[wv-size-tag]"),!r.length)throw new Error("wv-size#updateSize: [wv-size-tag] not found");e=r.width()+"px"}if(i(t)){if(r=r||s.closest("[wv-size-tag]"),!r.length)throw new Error("wv-size#updateSize: [wv-size-tag] not found");t=r.height()+"px"}if(n(e)&&n(t))this.setSpecificWidthAndSpecificHeight(e,t);else if(n(e)&&o(t))this.setSpecificWidthAndScaleHeight(e,t);else{if(!n(t)||!o(e))throw new Error("wv-size: unsupported options");this.setSpecificHeightAndScaleWidth(t,e)}},this.setWidth=function(e){var t=c(a).height;this.updateSize(e,t)},this.setHeight=function(e){var t=c(a).width;this.updateSize(t,e)},this.getWidthInPixel=function(){var e=c(a).width;return r(e)?+e.replace("px",""):+s.width()},this.getHeightInPixel=function(){var e=c(a).height;return r(e)?+e.replace("px",""):+s.height()},this.setSpecificWidthAndSpecificHeight=function(e,t){s.css("width",e),s.css("height",t),u.forEach(function(e){e()})},this.setSpecificWidthAndScaleHeight=function(e,t){var n=e.replace(/^([0-9]+)(\w+)$/,function(e,n,o){return n*t+o});s.css("width",e),s.css("height",n),u.forEach(function(e){e()})},this.setSpecificHeightAndScaleWidth=function(e,t){var n=e.replace(/^([0-9]+)(\w+)$/,function(e,n,o){return n*t+o});s.css("height",e),s.css("width",n),u.forEach(function(e){e()})}}function n(e){return _.isString(e)&&e.match(/^[0-9]+\w+$/)}function o(e){return _.isNumber(e)}function i(e){return _.isString(e)&&"[wv-size-tag]"===e}function r(e){return _.isString(e)&&e.match(/^[0-9]+(px)?$/)}e.$inject=["$timeout","$parse","debounce"],t.$inject=["_","$parse","$scope","$attrs","$element"],angular.module("webviewer").directive("wvSize",e)}(),angular.module("webviewer").directive("wvStudylist",["$http","wvConfig",function(e,t){return{scope:{wvSelectedStudy:"="},template:['<button type="button" class="btn btn-default wv-studylist" ','ng-model="wvSelectedStudy" placeholder="Study.." ','bs-options="study.value as study.label for study in studies"'," bs-select>","</button>"].join(""),restrict:"E",link:function(n,o,i){n.studies=[],e.get(t.orthancApiURL+"/studies/").then(function(o){var i=o.data;n.studies=i.map(function(e){return{label:"?",value:{id:e}}}),n.studies.forEach(function(n){e.get(t.orthancApiURL+"/studies/"+n.value.id).then(function(e){var t=e.data;n.label=t.MainDicomTags.StudyDescription})})})}}}]),function(){"use strict";function e(e,t){function n(t,n,o,i){var r=e(o.wvAngleMeasureViewportTool);t.$watch(r,function(e){e?i.activate():i.deactivate()})}function o(){t.call(this,"angle")}var i={require:"wvAngleMeasureViewportTool",controller:o,link:n,restrict:"A",scope:!1};return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,i}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvAngleMeasureViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvAngleMeasureViewportTool="?^wvAngleMeasureViewportTool",e}])}])}(),function(){"use strict";function e(e,t,n,o,i,r){function a(e){this.viewports=[],this.toolName=e,this.isActivated=!1}a.prototype.register=function(e){this.viewports.push(e),this._listenModelChange(e),this.isActivated&&this.activate(e)},a.prototype.unregister=function(e){this._unlistenModelChange(e),o.pull(this.viewports,e)},a.prototype._activateInputs=function(e){var t=e.getEnabledElement();i.mouseInput.enable(t),i[this.toolName].activate(t,!0)},a.prototype._deactivateInputs=function(e){var t=e.getEnabledElement();i[this.toolName].deactivate(t),i.mouseInput.disable(t)};return a.prototype._listenModelChange=function(e){var t=this,n=(this.toolName,e.getEnabledElement()),o=i.getElementToolStateManager(n),r=e.getImage(),a=r.getAnnotations(t.toolName);a&&o.restoreStateByToolAndImageId(a.type,a.imageId,a.data,!1),r.onAnnotationChanged([t,e],function(e){e.type===t.toolName&&o.restoreStateByToolAndImageId(e.type,e.imageId,e.data,!0)}),e.onImageChanging(this,function(n,i){i&&i.onAnnotationChanged.close([t,e]);var r=n.getAnnotations(t.toolName);r&&o.restoreStateByToolAndImageId(r.type,r.imageId,r.data,!1),n.onAnnotationChanged([t,e],function(e){e.type===t.toolName&&o.restoreStateByToolAndImageId(e.type,e.imageId,e.data,!0)})})},a.prototype._unlistenModelChange=function(e){var t=e.getImage();t&&t.onAnnotationChanged.close([this,e]),e.onImageChanging.close(this)},a.prototype._listenViewChange=function(t){var r=this,a=t.getEnabledElement(),l=i.getElementToolStateManager(a);n(a).on("CornerstoneImageRendered."+this.toolName,o.debounce(function(){var n=t.getImage(),i=l.getStateByToolAndImageId(r.toolName,n.id),a=n.getAnnotations(r.toolName);a&&o.isEqual(i,a.data)||e.$apply(function(){var e=o.clone(i);n.onAnnotationChanged.ignore([r,t],function(){e&&e.data.length?n.setAnnotations(r.toolName,e):e&&!e.data.length&&n.setAnnotations(r.toolName,null)})})},20))},a.prototype._unlistenViewChange=function(e){var t=e.getEnabledElement();n(t).off("CornerstoneImageRendered."+this.toolName)},a.prototype._process=function(e){},a.prototype._unprocess=function(e){},a.prototype.activate=function(e){if("undefined"==typeof e)this.viewports.forEach(this.activate.bind(this)),this.isActivated=!0;else{e.getEnabledElement();this._process(e),this._activateInputs(e),this._listenViewChange(e)}},a.prototype.deactivate=function(e){var t=this;this.viewports.forEach(function(e){t._unlistenViewChange(e),t._deactivateInputs(e),t._unprocess(e)}),this.isActivated=!1},a}e.$inject=["$rootScope","$timeout","$","_","cornerstoneTools","debounce"],angular.module("webviewer").factory("WvBaseTool",e)}(),function(){"use strict";function e(e,t,n){function o(e,n,o,i){var r=t(o.wvDefaultViewportTool);e.$watch(r,function(e){e?i.activate():i.deactivate()})}function i(t){n.call(this,"default"),this._activateInputs=function(n){var o=this,i=e(n.getEnabledElement());i.on("mousedown.dvt",function(i){var r=i.pageX,a=i.pageY,l=i.which;e(document).on("mousemove.dvt",function(i){t.$apply(function(){var e=i.pageX-r,t=i.pageY-a;r=i.pageX,a=i.pageY,1===l?o.setWindowing(n,e,t):2===l?o.pan(n,e,t):3===l&&o.zoom(n,t)}),e(document).one("mouseup",function(t){e(document).unbind("mousemove.dvt")})})})},this._deactivateInputs=function(t){var n=e(t.getEnabledElement());n.off("mousedown.dvt")},this._listenModelChange=angular.noop,this._unlistenModelChange=angular.noop,this._listenViewChange=angular.noop,this._unlistenViewChange=angular.noop,this.setWindowing=function(e,t,n){var o=e.getViewport(),i=+o.scale,r=+o.voi.windowWidth,a=+o.voi.windowCenter;o.voi.windowWidth=r+t/i,o.voi.windowCenter=a+n/i,e.setViewport(o)},this.pan=function(e,t,n){var o=e.getViewport(),i=+o.scale,r=+o.translation.x,a=+o.translation.y;o.translation.x=r+t/i,o.translation.y=a+n/i,e.setViewport(o)},this.zoom=function(e,t){var n=e.getViewport(),o=+n.scale;n.scale=o+t/100,e.setViewport(n)}}i.$inject=["$scope"];var r={require:"wvDefaultViewportTool",controller:i,link:o,restrict:"A",scope:!1};return i.prototype=Object.create(n.prototype),i.prototype.constructor=i,r}e.$inject=["$","$parse","WvBaseTool"],angular.module("webviewer").directive("wvDefaultViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvDefaultViewportTool="?^wvDefaultViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,o,i){var r=e(o.wvEllipticalRoiViewportTool);t.$watch(r,function(e){e?i.activate():i.deactivate()})}function o(){t.call(this,"ellipticalRoi")}var i={require:"wvEllipticalRoiViewportTool",controller:o,link:n,restrict:"A",scope:!1};return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,i}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvEllipticalRoiViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvEllipticalRoiViewportTool="?^wvEllipticalRoiViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,o,i){var r=e(o.wvHflipViewportTool);t.$watch(r,function(e){e?i.activate():i.deactivate()})}function o(){t.call(this,"hflip"),this._process=function(e){var t=this.onViewportSelected.bind(this);e.setSelectable(t)},this._unprocess=function(e){this.viewports.forEach(function(e){e.setUnselectable()})},this.onViewportSelected=function(e){var t=e.getViewport();t.hflip=!t.hflip,e.setViewport(t)},this._listenViewChange=angular.noop,this._unlistenViewChange=angular.noop,this._activateInputs=angular.noop,this._deactivateInputs=angular.noop,this._listenModelChange=angular.noop,this._unlistenModelChange=angular.noop}var i={require:"wvHflipViewportTool",controller:o,link:n,restrict:"A",scope:!1};return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,i}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvHflipViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvHflipViewportTool="?^wvHflipViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,o,i){var r=e(o.wvInvertContrastViewportTool);t.$watch(r,function(e){e?i.activate():i.deactivate()})}function o(){var e=this;t.call(this,"invertContrast"),this._listenViewChange=function(t){t.onViewportResetting(this,function(t){t.invert=e.isActivated})},this._unlistenViewChange=function(e){e.onViewportResetting.close(this)},this._process=function(e){var t=e.getViewport();t.invert=!0,e.setViewport(t)},this._unprocess=function(e){var t=e.getViewport();t.invert=!1,e.setViewport(t)},this._activateInputs=angular.noop,this._deactivateInputs=angular.noop,this._listenModelChange=angular.noop,this._unlistenModelChange=angular.noop}var i={require:"wvInvertContrastViewportTool",controller:o,link:n,restrict:"A",scope:!1};return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,i}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvInvertContrastViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvInvertContrastViewportTool="?^wvInvertContrastViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,o,i){var r=e(o.wvLengthMeasureViewportTool);t.$watch(r,function(e){e?i.activate():i.deactivate()})}function o(){t.call(this,"length")}var i={require:"wvLengthMeasureViewportTool",controller:o,link:n,restrict:"A",scope:!1};return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,i}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvLengthMeasureViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvLengthMeasureViewportTool="?^wvLengthMeasureViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,o,i){var r=e(o.wvPanViewportTool);t.$watch(r,function(e){e?i.activate():i.deactivate()})}function o(e){t.call(this,"pan"),this._activateInputs=function(t){var n=this,o=$(t.getEnabledElement());o.on("mousedown.pan",function(o){var i=o.pageX,r=o.pageY,a=o.which;$(document).on("mousemove.pan",function(o){e.$apply(function(){var e=o.pageX-i,l=o.pageY-r;i=o.pageX,r=o.pageY,1===a&&n.pan(t,e,l)}),$(document).one("mouseup",function(e){$(document).unbind("mousemove.pan")})})})},this._deactivateInputs=function(e){var t=$(e.getEnabledElement());t.off("mousedown.pan")},this._listenModelChange=angular.noop,this._unlistenModelChange=angular.noop,this._listenViewChange=angular.noop,this._unlistenViewChange=angular.noop,this.pan=function(e,t,n){var o=e.getViewport(),i=+o.scale,r=+o.translation.x,a=+o.translation.y;o.translation.x=r+t/i,o.translation.y=a+n/i,e.setViewport(o)}}o.$inject=["$scope"];var i={require:"wvPanViewportTool",controller:o,link:n,restrict:"A",scope:!1};return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,i}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvPanViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvPanViewportTool="?^wvPanViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,o,i){var r=e(o.wvPixelProbeViewportTool);t.$watch(r,function(e){e?i.activate():i.deactivate()})}function o(){t.call(this,"probe")}var i={require:"wvPixelProbeViewportTool",controller:o,link:n,restrict:"A",scope:!1};return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,i}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvPixelProbeViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvPixelProbeViewportTool="?^wvPixelProbeViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,o,i){var r=e(o.wvRectangleRoiViewportTool);
t.$watch(r,function(e){e?i.activate():i.deactivate()})}function o(){t.call(this,"rectangleRoi")}var i={require:"wvRectangleRoiViewportTool",controller:o,link:n,restrict:"A",scope:!1};return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,i}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvRectangleRoiViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvRectangleRoiViewportTool="?^wvRectangleRoiViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,o,i){var r=e(o.wvRotateleftViewportTool);t.$watch(r,function(e){e?i.activate():i.deactivate()})}function o(){t.call(this,"rotateLeft"),this._process=function(e){var t=this.onViewportSelected.bind(this);e.setSelectable(t)},this._unprocess=function(e){this.viewports.forEach(function(e){e.setUnselectable()})},this.onViewportSelected=function(e){var t=e.getViewport();t.rotation-=90,e.setViewport(t)},this._listenViewChange=angular.noop,this._unlistenViewChange=angular.noop,this._activateInputs=angular.noop,this._deactivateInputs=angular.noop,this._listenModelChange=angular.noop,this._unlistenModelChange=angular.noop}var i={require:"wvRotateleftViewportTool",controller:o,link:n,restrict:"A",scope:!1};return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,i}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvRotateleftViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvRotateleftViewportTool="?^wvRotateleftViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,o,i){var r=e(o.wvRotaterightViewportTool);t.$watch(r,function(e){e?i.activate():i.deactivate()})}function o(){t.call(this,"rotateRight"),this._process=function(e){var t=this.onViewportSelected.bind(this);e.setSelectable(t)},this._unprocess=function(e){this.viewports.forEach(function(e){e.setUnselectable()})},this.onViewportSelected=function(e){var t=e.getViewport();t.rotation+=90,e.setViewport(t)},this._listenViewChange=angular.noop,this._unlistenViewChange=angular.noop,this._activateInputs=angular.noop,this._deactivateInputs=angular.noop,this._listenModelChange=angular.noop,this._unlistenModelChange=angular.noop}var i={require:"wvRotaterightViewportTool",controller:o,link:n,restrict:"A",scope:!1};return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,i}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvRotaterightViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvRotaterightViewportTool="?^wvRotaterightViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,o,i){var r=e(o.wvVflipViewportTool);t.$watch(r,function(e){e?i.activate():i.deactivate()})}function o(){function e(e){var t=e.getViewport();t.vflip=!t.vflip,e.setViewport(t)}t.call(this,"vflip"),this._process=function(t){var n=e.bind(this);t.setSelectable(n)},this._unprocess=function(e){this.viewports.forEach(function(e){e.setUnselectable()})},this._listenViewChange=angular.noop,this._unlistenViewChange=angular.noop,this._activateInputs=angular.noop,this._deactivateInputs=angular.noop,this._listenModelChange=angular.noop,this._unlistenModelChange=angular.noop}var i={require:"wvVflipViewportTool",controller:o,link:n,restrict:"A",scope:!1};return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,i}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvVflipViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvVflipViewportTool="?^wvVflipViewportTool",e}])}])}(),function(){"use strict";function e(e,t){function n(t,n,o,i){var r=e(o.wvZoomViewportTool);t.$watch(r,function(e){e?i.activate():i.deactivate()})}function o(){t.call(this,"zoom")}var i={require:"wvZoomViewportTool",controller:o,link:n,restrict:"A",scope:!1};return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,i}e.$inject=["$parse","WvBaseTool"],angular.module("webviewer").directive("wvZoomViewportTool",e).config(["$provide",function(e){e.decorator("wvViewportDirective",["$delegate",function(e){var t=e[0];return t.require.wvZoomViewportTool="?^wvZoomViewportTool",e}])}])}(),function(){"use strict";function e(e){function n(t,n,o,i){var r=i.wvSerieId,a=i.wvViewport;r.onCurrentImageIdChanged(function(e,t,n){if(e){var o=t;a.setImage(e,o).then(function(){n&&n(e)})}else a.clearImage()});var l=e(o.wvSerieId);t.$watch(l,function(e){e?r.setSerie(e):r.clearSerie()});var s=e(o.wvOnSerieChange),c=e(o.wvSerie);r.onSerieChanged(function(e){c&&c.assign&&(c.assign(t,e),s&&s(t,{$serie:e}))}),_.filter(i,function(e,n){var o=_.endsWith(n,"SerieExt");e&&o&&(e.register(r),t.$on("$destroy",function(){e.unregister(r)}))})}var o={require:{wvSerieId:"wvSerieId",wvViewport:"wvViewport"},controller:t,link:n,restrict:"A",scope:!1};return o}function t(e){var t=this;this._serieManager=e,this._serieId=null,this._serie=null,this.onCurrentImageIdChanged=new osimis.Listener,this.onSerieChanged=new osimis.Listener,this.onSerieChanged(function(e,n){if(n&&n.onCurrentImageIdChanged.close(t),e){e.onCurrentImageIdChanged(t,function(e,n){t.onCurrentImageIdChanged.trigger(e,!1,n)});var o=e.getCurrentImageId();t.onCurrentImageIdChanged.trigger(o,!0)}else t.onCurrentImageIdChanged.trigger(null)})}e.$inject=["$parse"],t.$inject=["wvSerieManager"],angular.module("webviewer").directive("wvSerieId",e),t.prototype.hasSerie=function(){return!!this._serieId},t.prototype.onSerieChanged=angular.noop,t.prototype.clearSerie=function(){var e=this.serie;this._serieId=null,this._serie=null,this.onSerieChanged.trigger(null,e)},t.prototype.setSerie=function(e){var t=this;this._serieId=e,this._serieManager.get(e).then(function(e){var n=t._serie;t._serie=e,t.onSerieChanged.trigger(e,n)})},t.prototype.getSerie=function(){return this._serie}}(),function(){"use strict";function e(){function e(e,t,n){}var n={controller:t,link:e,restrict:"A",scope:!1};return n}function t(e,t,n){var o=[];this.register=function(e){o.push(e)},this.unregister=function(e){_.pull(o,e)};var i=$('<div class="wv-draggable-clone"></div>');t.draggable({helper:function(){return i},start:function(e,n){var i=o[0].getSerie();if(i){var r=n.helper;r.data("serie-id",i.id),r.width(t.width()),r.height(t.height())}},zIndex:100})}t.$inject=["$scope","$element","$attrs"],angular.module("webviewer").directive("wvDraggableSerieExt",e).config(["$provide",function(e){e.decorator("wvSerieIdDirective",["$delegate",function(e){var t=e[0];return t.require.wvDraggableSerieExt="?^wvDraggableSerieExt",e}])}])}(),function(){"use strict";function e(){function e(e,t,n,o){}var n={controller:t,link:e,restrict:"A",scope:!1};return n}function t(e,t){var n=[];this.register=function(e){n.push(e)},this.unregister=function(e){_.pull(n,e)},t.droppable({accept:"[wv-draggable-serie-ext]",drop:function(t,o){var i=$(o.helper),r=i.data("serie-id");e.$apply(function(){n.forEach(function(e){e.setSerie(r)})})}})}t.$inject=["$scope","$element"],angular.module("webviewer").directive("wvDroppableSerieExt",e).config(["$provide",function(e){e.decorator("wvSerieIdDirective",["$delegate",function(e){var t=e[0];return t.require.wvDroppableSerieExt="?^wvDroppableSerieExt",e}])}])}(),function(){"use strict";function e(e){function n(t,n,o,i){var r=e(o.wvPlaySerieExt);t.$watch(r,function(e){e?i.activate():i.deactivate()})}var o={require:"wvPlaySerieExt",controller:t,link:n,restrict:"A",scope:!1};return o}function t(e,t,n){var o=this,i=[];this.isActivated=!1,this.register=function(e){i.push(e);var t=e.getSerie();this.isActivated&&t&&this.activate(t),e.onSerieChanged(this,function(e,t){t&&o.isActivated&&o.deactivate(t),e&&o.isActivated&&o.activate(e)})},this.unregister=function(e){_.pull(i,e),e.onSerieChanged.close(this);var t=e.getSerie();this.deactivate(t)},this.activate=function(e){"undefined"==typeof e?(i.forEach(function(e){var t=e.getSerie();o.activate(t)}),this.isActivated=!0):e&&!e.isPlaying&&e.play()},this.deactivate=function(e){"undefined"==typeof e?(i.forEach(function(e){var t=e.getSerie();o.deactivate(t)}),this.isActivated=!1):e&&e.isPlaying&&e.pause()}}e.$inject=["$parse"],t.$inject=["$scope","$element","$attrs"],angular.module("webviewer").directive("wvPlaySerieExt",e).config(["$provide",function(e){e.decorator("wvSerieIdDirective",["$delegate",function(e){var t=e[0];return t.require.wvPlaySerieExt="?^wvPlaySerieExt",e}])}])}(),function(){"use strict";function e(){function e(e,t,n){}var n={controller:t,link:e,restrict:"A",scope:!1};return n}function t(e,t,n){function o(){e.$apply(function(){r.forEach(function(e){var t=e.getSerie();t&&t.play()})})}function i(){e.$apply(function(){r.forEach(function(e){var t=e.getSerie();t&&(t.pause(),t.goToImage(0))})})}var r=[];this.register=function(e){r.push(e)},this.unregister=function(e){_.pull(r,e)},t.on("mouseover",o).on("mouseout",i),e.$on("$destroy",function(){r.forEach(function(e){var t=e.getSerie();t&&t.pause()}),t.off("mouseover",o),t.off("mouseout",i)})}t.$inject=["$scope","$element","$attrs"],angular.module("webviewer").directive("wvScrollOnOverSerieExt",e).config(["$provide",function(e){e.decorator("wvSerieIdDirective",["$delegate",function(e){var t=e[0];return t.require.wvScrollOnOverSerieExt="?^wvScrollOnOverSerieExt",e}])}])}(),function(){"use strict";function e(){function e(e,t,n){}var n={controller:t,link:e,restrict:"A",scope:!1};return n}function t(e,t,n,o){function i(n){function o(o){var r=n.getSerie();if(r){i+=o.distance/20;var a=t.width()/r.imageCount;i>=a&&(e.$apply(function(){o.direction===Hammer.DIRECTION_LEFT?r.goToPreviousImage():o.direction===Hammer.DIRECTION_RIGHT&&r.goToNextImage(!1)}),i%=a),o.isFinal&&(i=0)}}s[n]=o,l.on("pan",s[n]);var i=0}function r(e){l.off("pan",s[e])}var a=[];this.register=function(e){a.push(e),i(e)},this.unregister=function(e){_.pull(a,e),r(e)},o=o(t[0]),o.wheel(function(t,n,o,i){e.$apply(function(){a.forEach(function(e){var t=e.getSerie();t&&(0>i?t.goToPreviousImage():i>0&&t.goToNextImage(!1))})}),t.preventDefault()}),e.$on("$destroy",function(){o.unwheel()});var l=new Hammer(t[0]);l.get("pan").set({direction:Hammer.DIRECTION_HORIZONTAL,pointers:1});var s={};e.$on("$destroy",function(){l.destroy()})}t.$inject=["$scope","$element","$attrs","hamster"],angular.module("webviewer").directive("wvScrollOnWheelSerieExt",e).config(["$provide",function(e){e.decorator("wvSerieIdDirective",["$delegate",function(e){var t=e[0];return t.require.wvScrollOnWheelSerieExt="?^wvScrollOnWheelSerieExt",e}])}])}(),function(){"use strict";function e(e,n,o,i,r,a,l,s){function c(e,t,o,i){function r(e,n){if(!e)return n.resizeViewport(t.width(),t.height()),null;var o=e&&e.onUpdate(function(){var t=e.getWidthInPixel(),o=e.getHeightInPixel();n.resizeViewport(t,o)});return function(){o()}}function a(e){n.forEach(i,function(t,o){var i=n.endsWith(o,"ViewportTool");t&&i&&e(t,o)})}var c=t.children(".wv-cornerstone-enabled-image")[0],v=new u(s,c);e.vm.wvEnableOverlay=!!e.vm.wvEnableOverlay;var p=(l(o.wvImageId),i.wvSize),w=r(p,v),g=i.wvViewport;g.getImage=function(){return v.getImageId()},g.setImage=function(t,n){return e.vm.wvImageId=t,v.setImage(t,n)},g.clearImage=function(){e.vm.wvImageId=null},e.$watch("vm.wvImageId",function(e,t){e?v.setImage(e):v.clearImage()}),v.onImageChanged(function(t){e.vm.wvImage=t,e.vm.wvOnImageChange&&e.vm.wvOnImageChange({$image:t})}),t.on("CornerstoneImageRendered",function(t,n){e.$evalAsync(function(){e.vm.wvViewport=n.viewport})}),e.$on("$destroy",function(){w&&(w(),w=null),v.destroy()}),v.onImageChanged.once(function(t){a(function(t){t.register(v),e.$on("$destroy",function(){t.unregister(v)})})})}function u(e,t){this._imageManager=e,this._enabledElement=t,this._imageId=null,this._image=null,this._viewportWidth=null,this._viewportHeight=null,this._cancelImageDisplaying=null,this.onImageChanging=new osimis.Listener,this.onImageChanged=new osimis.Listener,this.onViewportResetting=new osimis.Listener,o.enable(t)}function v(e,t,n,o){var i=o.width<=t&&o.height<=n;if(i)e.scale=1;else{var r=n/o.height,a=t/o.width;r>a?e.scale=a:e.scale=r,e.translation.x=0,e.translation.y=0}}var p={transclude:!0,bindToController:!0,controller:t,controllerAs:"vm",templateUrl:"app/viewport/viewport.directive.html",link:c,restrict:"E",require:{wvViewport:"wvViewport",wvSize:"?wvSize"},scope:{wvImageId:"=?",wvImage:"=?",wvOnImageChange:"&?",wvViewport:"=?",wvEnableOverlay:"=?"}};return u.prototype.onImageChanging=angular.noop,u.prototype.onImageChanged=angular.noop,u.prototype.destroy=function(){this._cancelImageDisplaying&&this._cancelImageDisplaying(),o.disable(this._enabledElement)},u.prototype.getEnabledElement=function(){return this._enabledElement},u.prototype.setSelectable=function(t){var n=this;if(this._onViewportSelectedCallback)throw new Error("viewport selection already active");this._onViewportSelectedCallback=function(){t(n)},e(this._enabledElement).on("click",this._onViewportSelectedCallback)},u.prototype.setUnselectable=function(){e(this._enabledElement).off("click",this._onViewportSelectedCallback),this._onViewportSelectedCallback=null},u.prototype.getViewport=function(){return o.getViewport(this._enabledElement)},u.prototype.setViewport=function(e){return o.setViewport(this._enabledElement,e)},u.prototype.getImageId=function(){return this._imageId},u.prototype.getImage=function(){return this._image},u.prototype.updateImage=function(e){!this.hasImage()},u.prototype.setImage=function(t,n){if(t==this._imageId&&!n)return a.reject("This image is already shown");n=n||!1,null===this._imageId&&(n=!0);var i=this;this._imageId=t,this._cancelImageDisplaying&&this._cancelImageDisplaying();var r=!1;return this._cancelImageDisplaying=function(){r=!0,i._cancelImageDisplaying=null},a.all({processedImage:i._imageManager.get(t).then(function(e){return e.getPixelObject()}),imageModel:i._imageManager.get(t)}).then(function(t){if(r)return a.reject("wv-viewport: image displaying canceled");var l,s=t.processedImage,c=t.imageModel,u=i._image;return l=n?i.resetViewport(s):o.getViewport(i._enabledElement),i.onImageChanging.trigger(c,u),o.displayImage(i._enabledElement,s,l),e(i._enabledElement).find("canvas").css("visibility","visible"),t}).then(function(e){if(r)return a.reject("wv-viewport: image displaying canceled");var t=e.imageModel,n=i._image;return i._image=t,i.onImageChanged.trigger(t,n),t})},u.prototype.clearImage=function(){this._imageId=null,e(this._enabledElement).find("canvas").css("visibility","hidden")},u.prototype.hasImage=function(){return null!==this._imageId},u.prototype.resizeViewport=function(t,n){var i=e(this._enabledElement);this._viewportWidth=t,this._viewportHeight=n,i.width(t),i.height(n),o.resize(this._enabledElement,!1);var r=o.getImage(this._enabledElement),a=o.getViewport(this._enabledElement);r&&a&&(v(a,this._viewportWidth,this._viewportHeight,r),o.displayImage(this._enabledElement,r,a))},u.prototype.resetViewport=function(e){var t=o.getDefaultViewportForImage(this._enabledElement,e);return v(t,this._viewportWidth,this._viewportHeight,e),this.onViewportResetting.trigger(t),t},p}function t(e,t,n,o){this.getImage=angular.noop,this.setImage=angular.noop,this.clearImage=angular.noop}e.$inject=["$","_","cornerstone","cornerstoneTools","$rootScope","$q","$parse","wvImageManager"],t.$inject=["$scope","$element","cornerstone","wvImageManager"],angular.module("webviewer").directive("wvViewport",e).run(["cornerstoneTools",function(e){var t=e.newImageIdSpecificToolStateManager();t.getStateByToolAndImageId=function(e,t){return this.toolState[t]&&this.toolState[t][e]},t.restoreStateByToolAndImageId=function(e,t,n,o){if("undefined"==typeof o&&(o=!0),this.toolState[t]=this.toolState[t]||{},this.toolState[t][e]=n,o){var i=cornerstone.getEnabledElementsByImageId(t);i.forEach(function(e){var t=e.element;cornerstone.draw(t)})}},e.globalImageIdSpecificToolStateManager=t}])}(),angular.module("webviewer").run(["$templateCache",function(e){e.put("app/overlay/droppable-serie-overlay-item.directive.html","<div ng-if=show class=wv-droppable-serie-overlay-item>[ drop a serie here ]</div>"),e.put("app/overlay/overlay.directive.html","<div class=wv-overlay ng-transclude><div class=wv-overlay-topleft ng-if=vm.showTopLeftArea()>{{vm.wvTags.PatientName}}<br>{{vm.wvTags.PatientID}}</div><div class=wv-overlay-topright ng-if=vm.showTopRightArea()>{{vm.wvTags.StudyDescription}}<br>{{vm.wvTags.StudyDate}}<br>#{{vm.wvTags.SeriesNumber}} - {{vm.wvTags.SeriesDescription}}<br></div><div class=wv-overlay-bottomright ng-if=vm.showBottomRightArea()>zoom: {{vm.wvViewport.scale|number:2}}<br>ww/wc: {{vm.wvViewport.voi.windowWidth|number:0}}/{{vm.wvViewport.voi.windowCenter|number:0}}</div><wv-scrollbar-overlay-item wv-image-count=vm.wvSerie.imageCount wv-image-index=vm.wvSerie.currentIndex wv-shown-image-index=vm.wvSerie.currentShownIndex ng-if=vm.showTimeline></wv-scrollbar-overlay-item><wv-droppable-serie-overlay-item></wv-droppable-serie-overlay-item></div>"),e.put("app/overlay/scrollbar-overlay-item.directive.html",'<div><div class=wv-overlay-scrollbar-text>{{vm.wvShownImageIndex + 1}}/{{vm.wvImageCount}}<br></div><div class=wv-overlay-scrollbar-loading ng-style="{ right: vm.loadingScrollbarDistanceFromRight }"></div><div class=wv-overlay-scrollbar-loaded ng-style="{ right: vm.loadedScrollbarDistanceFromRight }"></div></div>'),e.put("app/serielist/serielist.directive.html","<ul class={{wvClass.ul}}><li ng-repeat=\"id in serieIds\" class={{wvClass.li}} ng-transclude wv-size-tag><wv-viewport wv-serie-id=id wv-image=$image wv-size=\"{width: '[wv-size-tag]', height: '[wv-size-tag]'}\" wv-draggable-serie-ext wv-scroll-on-over-serie-ext><wv-overlay wv-tags=$image.tags><div class=wv-serielist-overlay>{{$image.tags.SeriesDescription}}</div></wv-overlay></wv-viewport></li></ul>"),e.put("app/splitpane/splitpane.directive.html",'<div class=wv-splitpane><div ng-repeat="$y in y | range track by $index" class=wv-splitpane-row ng-style="{height: rowHeight}"><div ng-repeat="$x in x | range track by $index" class=wv-splitpane-cell ng-style="{width: rowWidth}" wv-size-tag><ng-transclude></ng-transclude><div ng-if=showDefaultContent><wv-viewport wv-serie-id=randomSerieId wv-size="{width: \'[wv-size-tag]\', height:\'[wv-size-tag]\'}" wv-droppable-serie-ext wv-scroll-on-wheel-serie-ext wv-enable-overlay="!wvSettings || wvSettings.hasOwnProperty(\'overlay\') == false || wvSettings.overlay" wv-default-viewport-tool=wvSettings.windowing wv-angle-measure-viewport-tool=wvSettings.anglemeasure wv-length-measure-viewport-tool=wvSettings.lengthmeasure wv-elliptical-roi-viewport-tool=wvSettings.ellipticalroi wv-zoom-viewport-tool=wvSettings.zoom wv-pan-viewport-tool=wvSettings.pan wv-pixel-probe-viewport-tool=wvSettings.pixelprobe wv-rectangle-roi-viewport-tool=wvSettings.rectangleroi wv-invert-contrast-viewport-tool=wvSettings.invert wv-play-serie-ext=wvSettings.play wv-rotateright-viewport-tool=wvSettings.rotateright wv-rotateleft-viewport-tool=wvSettings.rotateleft wv-vflip-viewport-tool=wvSettings.vflip wv-hflip-viewport-tool=wvSettings.hflip></wv-viewport></div></div></div></div>'),e.put("app/toolbar/wv-toolbar-action.tpl.html",'<label class="btn btn-sm btn-default wv-toolbar-item" ng-if=wvItems.hasOwnProperty(wvName) ng-click=wvAction()><span ng-class=wvIcon></span></label>'),e.put("app/toolbar/wv-toolbar-setting.tpl.html",'<button type=button class="btn btn-sm btn-default wv-toolbar-item" html=1 placeholder="<span class=&quot;fa fa-th-large&quot;></span>" icon-checkmark="fa fa-th-large" bs-options="item.value as item.label for item in wvChoices" ng-model=wvItems[wvName] bs-select ng-if=wvItems.hasOwnProperty(wvName)></button>'),e.put("app/toolbar/wv-toolbar-state.tpl.html",'<label class="btn btn-sm btn-default wv-toolbar-item" ng-class="wvIcon || ($parent.$parent.activeStates[wvName] ? wvIconOn : wvIconOff)" ng-if=wvItems.hasOwnProperty(wvName)><input type=checkbox value={{wvName}} style="display: none;" ng-model=$parent.$parent.activeStates[wvName] bs-checkbox></label>'),e.put("app/toolbar/wv-toolbar-tool.tpl.html",'<label class="btn btn-sm btn-default wv-toolbar-item" ng-if=wvItems.hasOwnProperty(wvName)><span ng-class=wvIcon></span> <input type=radio value={{wvName}} style="display: none;" ng-model=$parent.$parent.activeTool bs-radio></label>'),e.put("app/toolbar/wv-toolbar.tpl.html",'<div class="wv-toolbar btn-toolbar" role=toolbar style="margin-left: 0;" ng-transclude ng-init="wvItems = wvItems || $parent.wvItems"><div class=wv-toolbar-settings><wv-toolbar-setting wv-name=layout wv-icon="fa fa-th-large" wv-choices="{ \'1x1\': {x: 1, y: 1}, \'2x1\': {x: 2, y: 1}, \'1x2\': {x: 1, y: 2}, \'2x2\': {x: 2, y: 2} }"></wv-toolbar-setting></div><div class=wv-toolbar-states><wv-toolbar-state wv-name=invert wv-icon="fa fa-adjust"></wv-toolbar-state><wv-toolbar-state wv-name=play wv-icon-on="fa fa-pause" wv-icon-off="fa fa-play"></wv-toolbar-state></div><div class=wv-toolbar-tools><wv-toolbar-tool wv-name=windowing wv-icon="fa fa-sun-o"></wv-toolbar-tool><wv-toolbar-tool wv-name=zoom wv-icon="fa fa-search"></wv-toolbar-tool><wv-toolbar-tool wv-name=pan wv-icon="fa fa-arrows"></wv-toolbar-tool><wv-toolbar-tool wv-name=lengthmeasure wv-icon="fa fa-arrows-v"></wv-toolbar-tool><wv-toolbar-tool wv-name=anglemeasure wv-icon="fa fa-angle-left"></wv-toolbar-tool><wv-toolbar-tool wv-name=pixelprobe wv-icon="fa fa-dot-circle-o"></wv-toolbar-tool><wv-toolbar-tool wv-name=ellipticalroi wv-icon="fa fa-circle-o"></wv-toolbar-tool><wv-toolbar-tool wv-name=rectangleroi wv-icon="fa fa-square-o"></wv-toolbar-tool></div><div class=wv-toolbar-tools><wv-toolbar-tool wv-name=rotateleft wv-icon="fa fa-rotate-left"></wv-toolbar-tool><wv-toolbar-tool wv-name=rotateright wv-icon="fa fa-rotate-right"></wv-toolbar-tool><wv-toolbar-tool wv-name=hflip wv-icon="fa fa-exchange"></wv-toolbar-tool><wv-toolbar-tool wv-name=vflip wv-icon="fa fa-exchange wv-toolbar-icon-rotate-right"></wv-toolbar-tool></div><div class=wv-toolbar-end></div></div>'),e.put("app/viewport/viewport.directive.html",'<div class="cornerstone-enabled-image wv-cornerstone-enabled-image" oncontextmenu="return false" unselectable=on onselectstart="return false;" onmousedown="return false;" style="position: relative;"><ng-transclude><wv-overlay wv-tags=vm.wvImage.tags wv-viewport=vm.wvViewport ng-if=vm.wvEnableOverlay></wv-overlay></ng-transclude></div>')}]);