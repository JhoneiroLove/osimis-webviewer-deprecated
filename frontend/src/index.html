<!DOCTYPE html>
<html ng-app="webviewer" class="wv-html">
<head>
    <style>
        /* This helps the ng-show/ng-hide animations start at the right place. */
        /* Since Angular has this but needs to load, this gives us the class early. */
        .ng-hide { display: none!important; }
    </style>
    <title ng-bind="title">Osimis' Web Viewer</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">

    <!-- build:css styles/lib.css -->
    <!-- bower:css -->
    <!-- endbower -->
    <!-- endbuild -->

    <!-- build:css fonts/fonts.css -->
    <!-- inject:fonts:css -->
    <!-- endinject -->
    <!-- endbuild -->

    <!-- build:css styles/app.css -->
    <!-- inject:css -->
    <!-- endinject -->
    <!-- endbuild -->
</head>
<body
    ng-controller="MainController as vm"
    class="wv-body"
>
    <wv-webviewer
        wv-study-id="vm.studyId"
        
        wv-toolbar-enabled="vm.enableToolbar"
        wv-serieslist-enabled="vm.enableLayoutLeft"
        wv-studyinformation-enabled="vm.enableLayoutLeft"
        wv-lefthandles-enabled="vm.enableLayoutLeftHandles"

        wv-notice-enabled="vm.enableNotice"
        wv-notice-text="vm.noticeText"
    >
        <!-- Study list (for debug mode) -->
        <wv-layout-top-left wv-enabled="vm.enableLayoutTopLeft">
            <wv-studylist 
                wv-selected-study-id="vm.studyId"
            ></wv-studylist>
        </wv-layout-top-left>
    </wv-webviewer>

    <!-- build:js js/lib.js -->
    <!-- bower:js -->
    <!-- endbower -->
    <!-- endbuild -->

    <!-- build:js js/app.js -->
    <!-- inject:js -->
    <!-- endinject -->

    <!-- inject:templates:js -->
    <!-- endinject -->
    <!-- endbuild -->

    <!-- Path served by webviewer's backend -->
    <script src="../config.js" type="text/javascript"></script>
    
    <script>
    angular
    .module('webviewer')
    // Remove debug info and improve performances
    // Can be reactivated on the fly using "angular.reloadWithDebugInfo();" in 
    // the console see
    // https://docs.angularjs.org/guide/production#disabling-debug-data
    .config(['$compileProvider', function ($compileProvider) {
        // $compileProvider.debugInfoEnabled(false);
    }])
    // Define a basic controller
    .controller('MainController', ['$scope', '$location', function($scope, $location) {
        var vm = this;

        // We could retrieve URL parameters here. This is not required for the 
        // index page though.

        // Configure the user interface depending on the user angent/browser.
        var userInterfacePolicy = new osimis.UserAgentBasedInterfacePolicy();
        vm.enableLayoutTopLeft = userInterfacePolicy.enableLayoutTopLeft;
        vm.enableToolbar = userInterfacePolicy.enableToolbar;
        vm.enableLayoutLeft = userInterfacePolicy.enableLayoutLeft;
        vm.enableLayoutLeftHandles = userInterfacePolicy.enableLayoutLeftHandles;
        vm.enableNotice = userInterfacePolicy.enableNotice;
        vm.noticeText = userInterfacePolicy.noticeText;

        // Listen to changes triggered by the user interface policy.    
        userInterfacePolicy.onUpdate(function() {
            $scope.$apply(function() {
                vm.enableLayoutTopLeft = userInterfacePolicy.enableLayoutTopLeft;
                vm.enableToolbar = userInterfacePolicy.enableToolbar;
                vm.enableLayoutLeft = userInterfacePolicy.enableLayoutLeft;
                vm.enableLayoutLeftHandles = userInterfacePolicy.enableLayoutLeftHandles;
                vm.enableNotice = userInterfacePolicy.enableNotice;
                vm.noticeText = userInterfacePolicy.noticeText;
            });
        });
    }]);
    </script>
</body>
</html>
